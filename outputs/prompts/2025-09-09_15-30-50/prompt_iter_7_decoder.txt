Translate the given pseudocode into a fully functioning, idiomatic, and highly efficient Python implementation. Strictly preserve all function names and signatures exactly as indicated in the pseudocode. Your translation must:

- Handle all edge cases explicitly described or reasonably implied by the pseudocode.
- Include definitions for any helper classes or functions assumed by the pseudocode.
- Produce clean, readable, and optimized Python code, leveraging any standard or well-known Python libraries if they significantly improve clarity or performance (e.g., collections, itertools, heapq), but avoid unnecessary dependencies.
- Complete execution within 5 seconds for typical inputs.
- Avoid adding any extra explanations, comments, or text beyond the requested code.
- Enclose the entire output exclusively within a single, properly formatted Python code block:
```python
# your complete code here
```

Here is the pseudocode: