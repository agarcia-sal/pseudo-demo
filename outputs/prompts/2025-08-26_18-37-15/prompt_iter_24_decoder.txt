Translate the provided pseudocode into a fully functional, idiomatic, and efficient Python implementation that strictly preserves all given function names, signatures, and type annotations. Your output must be a complete, runnable Python script optimized for clarity, correctness, and performance within a 5-second runtime constraint.

- Include all necessary imports and helper functions.
- Use type hints wherever specified or appropriate based on the pseudocode.
- Leverage standard Python libraries or modules (e.g., itertools, collections, math) to improve readability and efficiency if helpful.
- Ensure the translated code uses canonical Python idioms and data structures consistent with standard Python best practices.
- Maintain faithful logical equivalence and behavior with the input pseudocode (no deviations in output or side effects).
- Do NOT include explanations, comments (except minimal ones only if essential for complex logic), or any text outside the code block.
- Your entire response must be encapsulated within a single Python code block formatted as follows:

```python
# Your fully implemented Python code here
```

Produce the most polished, clear, and performant Python code possible that directly corresponds to the input pseudocode.