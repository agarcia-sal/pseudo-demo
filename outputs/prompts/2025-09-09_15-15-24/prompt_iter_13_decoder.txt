Translate the provided pseudocode into a clean, efficient, and fully correct Python 3 implementation that strictly adheres to the pseudocode’s logic, function names, and parameter lists without modification.  
- Preserve exactly the same function signature and names as specified.  
- Implement any helper classes or data structures described, placing them above the main function.  
- Employ Python 3 built-in libraries and idiomatic constructs for clarity and optimal performance; you may import any standard or third-party packages if they clearly improve correctness or efficiency, but avoid unnecessary dependencies.  
- The code must properly handle all edge cases inferred from the pseudocode and be optimized for execution within a 5-second time limit.  
- Provide only the complete Python code enclosed in a single code block, with no extra comments, explanations, or text outside the block unless imports or class definitions are required.  
- Use precise, minimal, and readable code, avoiding redundancy or partial/incomplete implementations.  
- Make sure all variables and control flow exactly mirror the pseudocode’s intent, including control conditions, loop structures, and data manipulations.

Output the full solution in a single block as follows:

```python
# your fully working code here
```