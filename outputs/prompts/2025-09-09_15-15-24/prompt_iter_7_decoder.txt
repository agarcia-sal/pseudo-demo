Translate the provided pseudocode into efficient, clean, and fully functional Python code that exactly follows the logic, naming, and function signature given.  
- Preserve the function name and parameters as stated in the pseudocode without alteration.  
- Implement any helper classes or data structures from the pseudocode precisely and place them before the main function.  
- Use idiomatic Python 3 syntax and standard library modules where they improve clarity or performance.  
- Ensure your solution is robust, handles all edge cases implied by the pseudocode, and runs within 5 seconds for typical inputs.  
- Do not add explanations, comments, or extra text outside the code unless strictly necessary (e.g., for defining classes or imports).  
- Return your entire solution within a single Python code block exactly as below:  

```python
# your fully working code here
```