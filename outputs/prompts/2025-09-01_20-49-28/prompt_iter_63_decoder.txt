```python
Translate the given pseudocode into a fully working, idiomatic, and production-quality Python implementation that:

- Keeps **exactly** the same function names, parameter names, and logical flow as in the pseudocode, without speculating or adding unrelated features.
- Infers and applies precise Python type hints reflecting input and output types, using standard typing constructs.
- Embraces Pythonic best practices: concise constructs (e.g., comprehensions, generator expressions), built-ins, and standard library functions for clarity and performance.
- Implements all edge cases and guards against invalid or unexpected inputs rigorously, raising appropriate exceptions only when clearly indicated or unavoidable.
- Avoids redundant computations, extraneous variables, and unnecessary imports; imports only what is strictly essential from the standard library or lightweight, widely accepted packages that demonstrably optimize clarity or efficiency without bloat.
- Does not add any debug prints, logging, or inline test scaffolding.
- Ensures the code runs efficiently within 5 seconds on typical inputs; optimize algorithmic complexity whenever obvious, without sacrificing readability.
- Outputs strictly a single, complete Python code block, fenced with triple backticks and labeled `python`.
- Provides no additional commentary, explanations, or text outside the code block.

Adhere strictly to this output format and style for consistent, high-quality translations.
```