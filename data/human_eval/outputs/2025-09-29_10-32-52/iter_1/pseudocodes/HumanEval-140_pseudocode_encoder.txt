```
FUNCTION fix_spaces(text)
    SET new_text TO empty string
    SET i TO 0
    SET start TO 0
    SET end TO 0
    WHILE i IS LESS THAN LENGTH OF text
        IF character AT text[i] IS SPACE
            INCREMENT end BY 1
        ELSE
            IF end MINUS start IS GREATER THAN 2
                CONCATENATE "-" AND text[i] TO new_text
            ELSE IF end MINUS start IS GREATER THAN 0
                CONCATENATE "_" REPEATED (end MINUS start) TIMES AND text[i] TO new_text
            ELSE
                CONCATENATE text[i] TO new_text
            SET start TO i PLUS 1
            SET end TO i PLUS 1
        INCREMENT i BY 1
    IF end MINUS start IS GREATER THAN 2
        CONCATENATE "-" TO new_text
    ELSE IF end MINUS start IS GREATER THAN 0
        CONCATENATE "_" TO new_text
    RETURN new_text
END FUNCTION
```