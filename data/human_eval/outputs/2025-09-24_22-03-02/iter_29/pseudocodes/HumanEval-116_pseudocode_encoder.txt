FUNCTION sort_array WITH PARAMETER arr
    SET sorted_by_value TO LIST WITH ELEMENTS EMPTY
    FOR i FROM 0 TO LENGTH OF arr MINUS 1
        APPEND ELEMENT arr AT INDEX i TO sorted_by_value
    SORT sorted_by_value IN ASCENDING ORDER
    SET sorted_by_bits TO LIST WITH ELEMENTS EMPTY
    FOR i FROM 0 TO LENGTH OF sorted_by_value MINUS 1
        SET current_element TO ELEMENT sorted_by_value AT INDEX i
        SET count_ones TO 0
        SET binary_representation TO STRING REPRESENTATION OF current_element IN BINARY FORM REMOVING FIRST TWO CHARACTERS
        FOR j FROM 0 TO LENGTH OF binary_representation MINUS 1
            IF CHARACTER AT INDEX j OF binary_representation EQUALS '1'
                INCREMENT count_ones BY 1
        APPEND TUPLE WITH ELEMENTS (count_ones, current_element) TO sorted_by_bits
    FOR i FROM 0 TO LENGTH OF sorted_by_bits MINUS 2
        FOR j FROM 0 TO LENGTH OF sorted_by_bits MINUS 2 MINUS i
            IF FIRST ELEMENT OF sorted_by_bits AT INDEX j GREATER THAN FIRST ELEMENT OF sorted_by_bits AT INDEX j PLUS 1 OR
               FIRST ELEMENTS EQUAL AND SECOND ELEMENT OF sorted_by_bits AT INDEX j GREATER THAN SECOND ELEMENT OF sorted_by_bits AT INDEX j PLUS 1
                SET temp TO sorted_by_bits AT INDEX j
                SET sorted_by_bits AT INDEX j TO sorted_by_bits AT INDEX j PLUS 1
                SET sorted_by_bits AT INDEX j PLUS 1 TO temp
    SET result TO LIST WITH ELEMENTS EMPTY
    FOR i FROM 0 TO LENGTH OF sorted_by_bits MINUS 1
        APPEND SECOND ELEMENT OF sorted_by_bits AT INDEX i TO result
    RETURN result