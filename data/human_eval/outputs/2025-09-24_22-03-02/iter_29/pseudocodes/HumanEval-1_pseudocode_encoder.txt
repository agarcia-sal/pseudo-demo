FUNCTION separate_paren_groups WITH PARAMETER paren_string OF TYPE str RETURNS LIST OF str
    SET result TO LIST WITH ELEMENTS EMPTY
    SET current_string TO LIST WITH ELEMENTS EMPTY
    SET current_depth TO 0
    FOR index FROM 0 TO LENGTH OF paren_string MINUS 1
        SET c TO paren_string AT INDEX index
        IF c EQUALS '('
            SET current_depth TO current_depth PLUS 1
            CALL current_string.APPEND WITH ARGUMENTS c
        ELSE IF c EQUALS ')'
            SET current_depth TO current_depth MINUS 1
            CALL current_string.APPEND WITH ARGUMENTS c
            IF current_depth EQUALS 0
                SET joined_string TO EMPTY STRING
                FOR j FROM 0 TO LENGTH OF current_string MINUS 1
                    SET joined_string TO CONCATENATE joined_string AND current_string AT INDEX j
                CALL result.APPEND WITH ARGUMENTS joined_string
                CALL current_string.CLEAR WITH NO ARGUMENTS
    RETURN result