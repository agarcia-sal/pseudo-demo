FUNCTION max_fill(grid)
    IMPORT math

    SET total_lowerings TO 0
    FOR row_index FROM 0 TO LENGTH OF grid MINUS 1
        SET current_row TO ELEMENT AT row_index IN grid
        SET water_units TO 0
        FOR element_index FROM 0 TO LENGTH OF current_row MINUS 1
            SET cell_value TO ELEMENT AT element_index IN current_row
            INCREMENT water_units BY cell_value
        SET required_lowerings TO CALL math.ceil WITH ARGUMENTS water_units DIVIDED BY capacity
        INCREMENT total_lowerings BY required_lowerings
    RETURN total_lowerings
END FUNCTION