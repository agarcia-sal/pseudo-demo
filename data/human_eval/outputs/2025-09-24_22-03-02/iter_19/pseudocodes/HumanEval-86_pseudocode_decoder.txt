FUNCTION anti_shuffle(s)
    SET words TO LIST WITH ELEMENTS EMPTY
    SET index TO 0
    SET length TO LENGTH OF s
    WHILE index LESS THAN length
        SET current_word TO EMPTY STRING
        WHILE index LESS THAN length AND CHARACTER AT s AT index NOT EQUAL TO " "
            CONCATENATE CHARACTER AT s AT index TO current_word
            INCREMENT index BY 1
        END WHILE
        APPEND current_word TO words
        IF index LESS THAN length AND CHARACTER AT s AT index EQUALS " "
            SET space_str TO EMPTY STRING
            WHILE index LESS THAN length AND CHARACTER AT s AT index EQUALS " "
                CONCATENATE CHARACTER AT s AT index TO space_str
                INCREMENT index BY 1
            END WHILE
            APPEND space_str TO words
        END IF
    END WHILE
    SET result_words TO LIST WITH ELEMENTS EMPTY
    FOR i FROM 0 TO LENGTH OF words MINUS 1
        IF words AT i EQUALS " " OR words AT i NOT EQUAL TO EMPTY STRING AND CHARACTER AT words AT i AT 0 NOT EQUAL TO " "
            SET char_list TO LIST WITH ELEMENTS EMPTY
            FOR j FROM 0 TO LENGTH OF words AT i MINUS 1
                APPEND CHARACTER AT words AT i AT j TO char_list
            END FOR
            SET sorted_chars TO LIST WITH ELEMENTS EMPTY
            WHILE LENGTH OF char_list GREATER THAN 0
                SET min_char TO char_list AT 0
                SET min_index TO 0
                FOR k FROM 1 TO LENGTH OF char_list MINUS 1
                    IF ASCII VALUE OF char_list AT k LESS THAN ASCII VALUE OF min_char
                        SET min_char TO char_list AT k
                        SET min_index TO k
                    END IF
                END FOR
                APPEND min_char TO sorted_chars
                REMOVE ELEMENT AT min_index FROM char_list
            END WHILE
            SET sorted_word TO EMPTY STRING
            FOR m FROM 0 TO LENGTH OF sorted_chars MINUS 1
                CONCATENATE sorted_chars AT m TO sorted_word
            END FOR
            APPEND sorted_word TO result_words
        ELSE
            APPEND words AT i TO result_words
        END IF
    END FOR
    SET result TO EMPTY STRING
    FOR n FROM 0 TO LENGTH OF result_words MINUS 1
        CONCATENATE result_words AT n TO result
    END FOR
    RETURN result
END FUNCTION