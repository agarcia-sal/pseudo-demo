FUNCTION parse_music WITH PARAMETER music_string OF TYPE string RETURNS LIST OF integers
    SET note_map TO DICTIONARY WITH KEYS AND VALUES 'o' EQUALS 4, 'o|' EQUALS 2, '.|' EQUALS 1
    SET tokens TO CALL split ON music_string WITH ARGUMENT ' '
    SET result TO LIST WITH ELEMENTS EMPTY
    SET index TO 0
    WHILE index LESS THAN LENGTH OF tokens
        SET x TO tokens AT INDEX index
        IF x NOT EQUAL TO EMPTY STRING
            SET beat TO CALL note_map AT KEY x
            APPEND beat TO result
        END IF
        INCREMENT index BY 1
    END WHILE
    RETURN result