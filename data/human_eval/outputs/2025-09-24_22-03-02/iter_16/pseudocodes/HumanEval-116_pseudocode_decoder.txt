FUNCTION sort_array(arr)
    SET sorted_by_value TO CALL sorted WITH ARGUMENTS arr
    SET sorted_by_ones TO CALL sorted WITH ARGUMENTS sorted_by_value AND key FUNCTION DEFINED AS
        FUNCTION key(x)
            SET binary_representation TO CALL bin WITH ARGUMENT x
            SET binary_string TO SUBSTRING OF binary_representation FROM INDEX 2 TO END
            SET count_ones TO CALL count ON binary_string WITH ARGUMENT '1'
            RETURN count_ones
    RETURN sorted_by_ones