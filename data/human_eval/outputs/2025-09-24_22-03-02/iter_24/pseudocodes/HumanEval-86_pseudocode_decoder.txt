FUNCTION anti_shuffle(s)
    SET words TO LIST WITH ELEMENTS EMPTY
    SET index TO 0
    WHILE index LESS THAN LENGTH OF s
        SET current_word TO EMPTY STRING
        WHILE index LESS THAN LENGTH OF s AND CHARACTER AT s AT index NOT EQUAL TO SPACE
            CONCATENATE current_word WITH CHARACTER AT s AT index
            INCREMENT index BY 1
        END WHILE
        APPEND current_word TO words
        SET space_sequence TO EMPTY STRING
        WHILE index LESS THAN LENGTH OF s AND CHARACTER AT s AT index EQUALS SPACE
            CONCATENATE space_sequence WITH CHARACTER AT s AT index
            INCREMENT index BY 1
        END WHILE
        IF LENGTH OF space_sequence GREATER THAN 0
            APPEND space_sequence TO words
        END IF
    END WHILE
    SET result TO EMPTY STRING
    SET word_index TO 0
    WHILE word_index LESS THAN LENGTH OF words
        SET element TO words[word_index]
        IF element DOES NOT CONTAIN SPACE
            SET char_list TO LIST WITH ELEMENTS EMPTY
            FOR char_index FROM 0 TO LENGTH OF element MINUS 1
                APPEND CHARACTER AT element AT char_index TO char_list
            END FOR
            SET sorted_chars TO LIST WITH ELEMENTS EMPTY
            WHILE LENGTH OF char_list GREATER THAN 0
                SET min_char TO CHARACTER WITH ASCII VALUE GREATER THAN 127
                FOR char_in_list_index FROM 0 TO LENGTH OF char_list MINUS 1
                    IF ASCII VALUE OF char_list AT char_in_list_index LESS THAN ASCII VALUE OF min_char
                        SET min_char TO char_list AT char_in_list_index
                    END IF
                END FOR
                APPEND min_char TO sorted_chars
                REMOVE FIRST OCCURRENCE OF min_char FROM char_list
            END WHILE
            SET sorted_word TO EMPTY STRING
            FOR sorted_char_index FROM 0 TO LENGTH OF sorted_chars MINUS 1
                CONCATENATE sorted_word WITH sorted_chars AT sorted_char_index
            END FOR
            CONCATENATE result WITH sorted_word
        ELSE
            CONCATENATE result WITH element
        END IF
        INCREMENT word_index BY 1
    END WHILE
    RETURN result
END FUNCTION