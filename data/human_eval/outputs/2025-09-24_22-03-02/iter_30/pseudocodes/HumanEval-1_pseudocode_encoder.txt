FUNCTION separate_paren_groups WITH PARAMETER paren_string OF TYPE STRING RETURNS LIST OF STRING
    SET result TO LIST WITH ELEMENTS EMPTY
    SET current_string TO LIST WITH ELEMENTS EMPTY
    SET current_depth TO 0

    FOR index FROM 0 TO LENGTH OF paren_string MINUS 1
        SET c TO CHARACTER AT INDEX index OF paren_string

        IF c EQUALS '(' THEN
            SET current_depth TO current_depth PLUS 1
            CALL APPEND ON current_string WITH ARGUMENTS c

        ELSE IF c EQUALS ')' THEN
            SET current_depth TO current_depth MINUS 1
            CALL APPEND ON current_string WITH ARGUMENTS c

            IF current_depth EQUALS 0 THEN
                SET joined_string TO EMPTY STRING
                FOR i FROM 0 TO LENGTH OF current_string MINUS 1
                    SET joined_string TO joined_string CONCATENATE ELEMENT AT INDEX i OF current_string
                CALL APPEND ON result WITH ARGUMENTS joined_string
                CALL CLEAR ON current_string
            END IF
        END IF
    END FOR

    RETURN result
END FUNCTION