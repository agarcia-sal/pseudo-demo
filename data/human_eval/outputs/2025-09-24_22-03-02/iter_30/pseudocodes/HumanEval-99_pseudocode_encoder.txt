FUNCTION closest_integer(value)
    IMPORT floor FROM math
    IMPORT ceil FROM math

    SET dot_count TO zero
    SET i TO zero
    WHILE i LESS THAN LENGTH OF value
        IF CHAR AT value AT i EQUALS '.'
            INCREMENT dot_count BY one
        END IF
        INCREMENT i BY one
    END WHILE

    IF dot_count EQUALS one
        WHILE LENGTH OF value GREATER THAN zero
            SET last_char_index TO LENGTH OF value MINUS one
            IF CHAR AT value AT last_char_index EQUALS '0'
                SET value TO SUBSTRING OF value FROM zero TO last_char_index
            ELSE
                BREAK
            END IF
        END WHILE
    END IF

    SET num TO CALL float WITH ARGUMENTS value

    IF LENGTH OF value GREATER THAN OR EQUAL TO two
        SET last_two_chars_index_start TO LENGTH OF value MINUS two
        SET last_two_chars TO CONCATENATE CHAR AT value AT last_two_chars_index_start AND CHAR AT value AT (last_two_chars_index_start PLUS one)
    ELSE
        SET last_two_chars TO EMPTY STRING
    END IF

    IF last_two_chars EQUALS '.5'
        IF num GREATER THAN zero
            SET res TO CALL ceil WITH ARGUMENTS num
        ELSE
            SET res TO CALL floor WITH ARGUMENTS num
        END IF
    ELSE
        IF LENGTH OF value GREATER THAN zero
            SET res TO CALL round WITH ARGUMENTS num
            SET res TO CAST res TO INTEGER
        ELSE
            SET res TO zero
        END IF
    END IF

    RETURN res
END FUNCTION