FUNCTION closest_integer WITH PARAMETER value
    IMPORT floor FROM math
    IMPORT ceil FROM math

    SET dot_count TO 0
    FOR index FROM 0 TO LENGTH OF value MINUS 1
        IF CHARACTER AT value AT index EQUALS '.'
            INCREMENT dot_count BY 1
        END IF
    END FOR

    IF dot_count EQUALS 1
        WHILE LENGTH OF value GREATER THAN 0 AND CHARACTER AT value AT LENGTH OF value MINUS 1 EQUALS '0'
            SET value TO SUBSTRING OF value FROM INDEX zero TO LENGTH OF value MINUS 1
        END WHILE
    END IF

    SET num TO CALL float WITH ARGUMENT value

    IF LENGTH OF value GREATER THAN OR EQUAL TO 2
        SET last_two_chars TO SUBSTRING OF value FROM INDEX LENGTH OF value MINUS 2 TO LENGTH OF value
    ELSE
        SET last_two_chars TO EMPTY STRING
    END IF

    IF last_two_chars EQUALS '.5'
        IF num GREATER THAN 0
            SET res TO CALL ceil WITH ARGUMENT num
        ELSE
            SET res TO CALL floor WITH ARGUMENT num
        END IF
    ELSE
        IF LENGTH OF value GREATER THAN 0
            SET rounded_num TO CALL round WITH ARGUMENT num
            SET res TO CALL int WITH ARGUMENT rounded_num
        ELSE
            SET res TO 0
        END IF
    END IF

    RETURN res
END FUNCTION