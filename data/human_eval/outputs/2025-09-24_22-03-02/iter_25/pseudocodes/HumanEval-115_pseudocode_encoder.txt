FUNCTION max_fill(grid, capacity)
    IMPORT math
    SET total_bucket_lowerings TO 0
    SET grid_length TO LENGTH OF grid
    FOR i FROM 0 TO grid_length MINUS 1
        SET current_row TO grid AT INDEX i
        SET sum_of_water_units TO 0
        SET current_row_length TO LENGTH OF current_row
        FOR j FROM 0 TO current_row_length MINUS 1
            SET sum_of_water_units TO sum_of_water_units PLUS current_row AT INDEX j
        END FOR
        SET bucket_lowerings_for_current_row TO CALL math.ceil WITH ARGUMENT sum_of_water_units DIVIDE BY capacity
        SET total_bucket_lowerings TO total_bucket_lowerings PLUS bucket_lowerings_for_current_row
    END FOR
    RETURN total_bucket_lowerings
END FUNCTION