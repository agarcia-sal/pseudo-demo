FUNCTION prime_fib(n : INTEGER) RETURNS INTEGER
    FUNCTION is_prime(p : INTEGER) RETURNS BOOLEAN
        IF p LESS THAN 2 THEN
            RETURN FALSE
        END IF
        SET limit TO INTEGER PART OF (CALL math.sqrt WITH ARGUMENT p) PLUS 1
        IF limit GREATER THAN p MINUS 1 THEN
            SET limit TO p MINUS 1
        END IF
        FOR k FROM 2 TO limit MINUS 1 DO
            IF p MODULO k EQUALS 0 THEN
                RETURN FALSE
            END IF
        END FOR
        RETURN TRUE
    END FUNCTION

    SET f TO LIST WITH ELEMENTS 0 AND 1
    WHILE TRUE DO
        SET length_f TO LENGTH OF f
        SET new_fib TO f[length_f MINUS 1] PLUS f[length_f MINUS 2]
        APPEND new_fib TO f
        SET last_index TO LENGTH OF f MINUS 1
        SET is_prime_result TO CALL is_prime WITH ARGUMENT f[last_index]
        IF is_prime_result EQUALS TRUE THEN
            SET n TO n MINUS 1
        END IF
        IF n EQUALS 0 THEN
            RETURN f[last_index]
        END IF
    END WHILE
END FUNCTION