FUNCTION parse_music WITH PARAMETER music_string OF TYPE STRING RETURNS LIST OF INTEGERS
    SET note_map TO DICTIONARY WITH KEYS AND VALUES:
        KEY 'o' VALUE 4
        KEY 'o|' VALUE 2
        KEY '.|' VALUE 1
    SET result TO LIST WITH ELEMENTS EMPTY
    SET split_notes TO CALL method split ON music_string WITH ARGUMENT ' '
    FOR index FROM 0 TO LENGTH OF split_notes MINUS 1
        SET current_note TO split_notes AT index
        IF current_note NOT EQUAL TO EMPTY STRING
            SET note_value TO VALUE OF note_map WITH KEY current_note
            APPEND note_value TO result
    RETURN result