FUNCTION max_fill(grid, capacity)
    IMPORT math

    SET total_lowerings TO 0

    FOR i FROM 0 TO LENGTH OF grid MINUS 1
        SET current_row TO grid AT INDEX i
        SET sum_water TO 0

        FOR j FROM 0 TO LENGTH OF current_row MINUS 1
            ADD current_row AT INDEX j TO sum_water
        END FOR

        SET lowers_for_row TO CALL math.ceil WITH ARGUMENTS (sum_water DIVIDE BY capacity)
        ADD lowers_for_row TO total_lowerings
    END FOR

    RETURN total_lowerings
END FUNCTION