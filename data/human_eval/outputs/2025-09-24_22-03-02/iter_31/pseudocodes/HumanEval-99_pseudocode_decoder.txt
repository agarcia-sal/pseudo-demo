FUNCTION closest_integer(value)
    IMPORT floor FROM math
    IMPORT ceil FROM math

    SET count_dot TO 0
    FOR index FROM 0 TO LENGTH OF value MINUS 1
        IF value AT index EQUALS '.'
            INCREMENT count_dot
        END IF
    END FOR

    IF count_dot EQUALS 1
        WHILE LENGTH OF value GREATER THAN 0
            SET last_index TO LENGTH OF value MINUS 1
            IF value AT last_index EQUALS '0'
                SET value TO SUBSTRING OF value FROM zero TO last_index MINUS 1
            ELSE
                BREAK
            END IF
        END WHILE
    END IF

    SET num TO CONVERT value TO FLOAT

    SET length_value TO LENGTH OF value
    IF length_value GREATER THAN OR EQUAL TO 2
        SET second_last_index TO length_value MINUS 2
        SET last_index TO length_value MINUS 1
    ELSE
        SET second_last_index TO -1
        SET last_index TO -1
    END IF

    IF second_last_index NOT EQUAL TO -1 AND last_index NOT EQUAL TO -1
        SET substring_last_two TO CONCATENATE value AT second_last_index AND value AT last_index
    ELSE
        SET substring_last_two TO EMPTY STRING
    END IF

    IF substring_last_two EQUALS '.5'
        IF num GREATER THAN 0
            SET res TO CALL ceil WITH ARGUMENTS num
        ELSE
            SET res TO CALL floor WITH ARGUMENTS num
        END IF
    ELSE
        IF length_value GREATER THAN 0
            SET rounded_num TO ROUND num TO NEAREST INTEGER
            SET res TO CONVERT rounded_num TO INTEGER
        ELSE
            SET res TO 0
        END IF
    END IF

    RETURN res
END FUNCTION