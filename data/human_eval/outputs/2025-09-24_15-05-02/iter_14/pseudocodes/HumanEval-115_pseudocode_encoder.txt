```
FUNCTION max_fill(grid, capacity)
    SET total_to_lower_buckets TO 0
    FOR each well IN grid
        SET water_units TO SUM OF well
        SET lowers_for_well TO CEILING OF water_units DIVIDED BY capacity
        INCREMENT total_to_lower_buckets BY lowers_for_well
    RETURN total_to_lower_buckets
END FUNCTION
```