```
FUNCTION max_fill(grid, capacity)
    RETURN SUM OF CEILING OF (SUM OF each row DIVIDED BY capacity) FOR each row IN grid
END FUNCTION
```