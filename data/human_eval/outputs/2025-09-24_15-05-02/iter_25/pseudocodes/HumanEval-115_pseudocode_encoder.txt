```
FUNCTION max_fill(grid, capacity)
    SET total_times TO 0
    FOR each row IN grid
        SET units_of_water TO SUM OF elements FROM index 0 TO LENGTH OF row MINUS 1 IN row
        SET times_for_row TO CEILING OF units_of_water DIVIDED BY capacity
        INCREMENT total_times BY times_for_row
    RETURN total_times
END FUNCTION
```