```
FUNCTION max_fill(grid, capacity)
    IMPORT math
    SET total_bucket_lowerings TO 0
    FOR each well_row IN grid
        SET water_units_in_well TO SUM OF well_row
        SET lowers_for_well TO math.ceil(water_units_in_well DIVIDED BY capacity)
        INCREMENT total_bucket_lowerings BY lowers_for_well
    RETURN total_bucket_lowerings
END FUNCTION
```