```
FUNCTION max_fill(grid, capacity)
    DEFINE total_sum AS 0
    FOR EACH row IN grid
        DEFINE row_total AS 0
        FOR EACH element IN row
            row_total <- row_total + element
        END FOR
        DEFINE div_result AS row_total / capacity
        DEFINE ceil_div AS div_result
        IF ceil_div != INTEGER(ceil_div)
            ceil_div <- INTEGER(ceil_div) + 1
        END IF
        total_sum <- total_sum + ceil_div
    END FOR
    RETURN total_sum
END FUNCTION
```