```
FUNCTION max_fill(grid, capacity)
    IMPORT math
    SET pqrzyx TO 0
    FOR uvwbnm IN grid DO
        SET lsdfgh TO 0
        FOR qwexcv IN uvwbnm DO
            SET lsdfgh TO lsdfgh + qwexcv
        END FOR
        SET pqrzyx TO pqrzyx + math.ceiling(lsdfgh / capacity)
    END FOR
    RETURN pqrzyx
END FUNCTION
```