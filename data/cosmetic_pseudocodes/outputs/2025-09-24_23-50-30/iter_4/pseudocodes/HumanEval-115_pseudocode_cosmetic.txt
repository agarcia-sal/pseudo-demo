```
FUNCTION max_fill(grid, capacity)
    IMPORT math
    FUNCTION row_fill_count(r, cap)
        RETURN math ceiling(r / cap)
    END FUNCTION

    FUNCTION recursive_sum(rows, idx, acc)
        IF idx == LENGTH(rows) THEN
            RETURN acc
        ELSE
            RETURN recursive_sum(rows, idx + 1, acc + row_fill_count(SUM(rows[idx]), capacity))
        END IF
    END FUNCTION

    RETURN recursive_sum(grid, 0, 0)
END FUNCTION
```