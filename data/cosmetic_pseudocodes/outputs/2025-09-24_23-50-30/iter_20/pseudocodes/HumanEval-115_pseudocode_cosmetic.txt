```
FUNCTION max_fill(grid, capacity)
    SET total_cells TO 0
    FOR EACH row_data IN grid DO
        SET row_sum TO 0
        FOR EACH element_value IN row_data DO
            SET row_sum TO row_sum + element_value
        END FOR
        IF (row_sum MOD capacity) EQUALS 0 THEN
            SET parts TO row_sum DIV capacity
        ELSE
            SET parts TO (row_sum DIV capacity) + 1
        END IF
        SET total_cells TO total_cells + parts
    END FOR
    RETURN total_cells
END FUNCTION
```