```
FUNCTION max_fill(grid, capacity)
    IMPORT math
    DEFINE FUNCTION helper(accumulator, index)
        IF index EQUALS LENGTH(grid) THEN
            RETURN accumulator
        ELSE
            DEFINE FUNCTION row_sum(rowlist, pointer, total)
                IF pointer EQUALS LENGTH(rowlist) THEN
                    RETURN total
                ELSE
                    RETURN row_sum(rowlist, pointer + 1, total + rowlist[pointer])
                END IF
            END FUNCTION
            DEFINE VARIABLE current_row_sum = row_sum(grid[index], 0, 0)
            DEFINE VARIABLE division_result = current_row_sum / capacity
            DEFINE VARIABLE ceil_value = (division_result = INTEGER(division_result)) ? INTEGER(division_result) : INTEGER(division_result) + 1
            RETURN helper(accumulator + ceil_value, index + 1)
        END IF
    END FUNCTION
    RETURN helper(0, 0)
END FUNCTION
```