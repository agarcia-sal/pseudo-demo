```
FUNCTION search(arr)
    SET freq TO array_of_length(max(arr)+1) FILLED_WITH 0
    PROCEDURE accumulate(i)
        IF i > length(arr)
            RETURN
        freq[arr[i]] = freq[arr[i]] + 1
        accumulate(i + 1)
    END PROCEDURE
    accumulate(1)
    SET result TO -1
    SET j TO 1
    WHILE j < length(freq)
        SWITCH freq[j] >= j
            CASE true: result = j
            CASE false: NO_OP
        END SWITCH
        j = j + 1
    END WHILE
    RETURN result
END FUNCTION
```