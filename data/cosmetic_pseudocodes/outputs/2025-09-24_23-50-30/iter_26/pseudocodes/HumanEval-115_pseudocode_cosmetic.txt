```
FUNCTION max_fill(grid, capacity)
    IMPORT math
    DEFINE FUNCTION accumulate_rows(rows_list, accumulator)
        IF rows_list IS EMPTY THEN
            RETURN accumulator
        ELSE
            LET head_row BE rows_list FIRST ELEMENT
            LET tail_rows BE rows_list REMAINING ELEMENTS
            LET partial_sum BE 0
            FOR EACH element IN head_row DO
                partial_sum ‚Üê partial_sum + element
            END FOR
            LET partial_ceil BE math ceiling of (partial_sum / capacity)
            RETURN accumulate_rows(tail_rows, accumulator + partial_ceil)
        END IF
    END FUNCTION
    RETURN accumulate_rows(grid, 0)
END FUNCTION
```