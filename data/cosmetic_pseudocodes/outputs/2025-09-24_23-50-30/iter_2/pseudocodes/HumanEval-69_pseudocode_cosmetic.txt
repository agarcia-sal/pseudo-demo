```
FUNCTION search(list_of_integers)
    LET freq_map BE A DICTIONARY MAPPING INTEGERS TO INTEGERS WITH DEFAULT 0
    LET highest_val BE -1
    LET idx BE LENGTH(list_of_integers) - 1
    WHILE idx >= 0
        LET num BE list_of_integers[idx]
        freq_map[num] = freq_map.get(num, 0) + 1
        IF num > highest_val THEN
            highest_val = num
        END IF
        idx = idx - 1
    END WHILE

    LET answer BE -1
    LET candidate_keys BE list(freq_map.keys())
    FOR i IN reversed(range(1, highest_val + 1))
        LET count BE freq_map.get(i, 0)
        IF NOT (count < i)
            answer = i
            BREAK
        END IF
    END FOR

    RETURN answer
END FUNCTION
```