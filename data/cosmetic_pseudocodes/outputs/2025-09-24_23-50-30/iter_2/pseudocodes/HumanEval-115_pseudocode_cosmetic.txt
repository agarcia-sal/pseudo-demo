```
FUNCTION max_fill(grid, capacity)
    IMPORT math
    total = 0
    idx = 0
    n = LENGTH(grid)
    WHILE idx < n
        row_sum = 0
        FOR val IN grid[idx]
            row_sum = row_sum + val
        END FOR
        total = total + (math.ceil)(row_sum / capacity)
        idx = idx + 1
    END WHILE
    RETURN total
END FUNCTION
```