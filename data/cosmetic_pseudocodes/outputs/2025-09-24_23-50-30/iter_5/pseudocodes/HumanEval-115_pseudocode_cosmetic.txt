```
FUNCTION max_fill(grid, capacity)
    RESULT := 0
    INDEX := 0
    LENGTH := LENGTH(grid)

    WHILE INDEX < LENGTH DO
        CURRENT_ROW := grid[INDEX]
        ROW_TOTAL := 0
        POS := 0
        ROW_LENGTH := LENGTH(CURRENT_ROW)

        LOOP
            IF POS >= ROW_LENGTH THEN 
                BREAK
            ENDIF
            ROW_TOTAL := ROW_TOTAL + CURRENT_ROW[POS]
            POS := POS + 1
        ENDLOOP

        DIVISION := ROW_TOTAL / capacity
        IF DIVISION = INTEGER(DIVISION) THEN
            CEIL_VALUE := INTEGER(DIVISION)
        ELSE
            CEIL_VALUE := INTEGER(DIVISION) + 1
        ENDIF

        RESULT := RESULT + CEIL_VALUE
        INDEX := INDEX + 1
    ENDWHILE

    RETURN RESULT
END FUNCTION
```