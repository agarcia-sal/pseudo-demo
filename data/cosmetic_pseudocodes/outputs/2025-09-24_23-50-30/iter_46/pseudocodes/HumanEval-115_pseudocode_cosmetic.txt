```
FUNCTION max_fill(grid, capacity)
    IMPORT math
    FUNCTION compute_row_totals(list_rows, acc_total)
        IF list_rows IS EMPTY THEN
            RETURN acc_total
        ELSE
            RETURN compute_row_totals(
                TAIL OF list_rows,
                acc_total + HEAD OF list_rows
            )
        END IF
    END FUNCTION

    FUNCTION ceiling_division(value)
        RETURN math ceiling(value / capacity)
    END FUNCTION

    FUNCTION aggregate_ceils(rows_list, running_sum)
        IF rows_list IS EMPTY THEN
            RETURN running_sum
        ELSE
            LET current_row_sum = compute_row_totals(HEAD OF rows_list, 0)
            RETURN aggregate_ceils(
                TAIL OF rows_list,
                running_sum + ceiling_division(current_row_sum)
            )
        END IF
    END FUNCTION

    RETURN aggregate_ceils(grid, 0)
END FUNCTION
```