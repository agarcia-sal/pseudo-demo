```
FUNCTION max_fill(grid, capacity)
    DEFINE helper(rowset, acc)
        IF rowset IS EMPTY THEN
            RETURN acc
        ELSE
            LET head = FIRST ELEMENT OF rowset
            LET tail = ALL BUT FIRST ELEMENT OF rowset
            LET partialSum = (SUM OF ELEMENTS IN head) / capacity
            LET increment = (PARTIALSUM - INTEGER PART OF partialSum == 0) 
                            ? INTEGER PART OF partialSum 
                            : INTEGER PART OF partialSum + 1
            RETURN helper(tail, acc + increment)
        END IF
    END DEFINE
    
    RETURN helper(grid, 0)
END FUNCTION
```