```
FUNCTION max_fill(grid, capacity)
    IMPORT math
    VARIABLE accList <- EMPTY LIST
    FOR idx FROM 0 TO LENGTH(grid) - 1 DO
        VARIABLE tempSum <- 0
        VARIABLE rowData <- grid[idx]
        FOR elemIdx FROM 0 TO LENGTH(rowData) - 1 DO
            tempSum <- tempSum + rowData[elemIdx]
        END FOR
        accList APPEND math ceiling(tempSum / capacity)
    END FOR
    VARIABLE totalValue <- 0
    VARIABLE accIdx <- 0
    WHILE accIdx < LENGTH(accList) DO
        totalValue <- totalValue + accList[accIdx]
        accIdx <- accIdx + 1
    END WHILE
    RETURN totalValue
END FUNCTION
```