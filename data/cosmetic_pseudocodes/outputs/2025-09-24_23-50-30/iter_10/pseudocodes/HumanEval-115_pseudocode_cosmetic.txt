```
FUNCTION max_fill(grid, capacity)
    DEFINE accumulator = 0
    FOR each collection IN grid DO
        DEFINE total = 0
        FOR each element IN collection DO
            total = total + element
        END FOR
        DEFINE fraction = total / capacity
        DEFINE integral_part = fraction
        IF integral_part * capacity < total THEN
            integral_part = integral_part + 1
        END IF
        accumulator = accumulator + integral_part
    END FOR
    RETURN accumulator
END FUNCTION
```