```
FUNCTION max_fill(grid, capacity)
    IMPORT math
    total_fill = 0
    FOR i = 0 TO LENGTH(grid) - 1
        row_sum = 0
        FOR val IN grid[i]
            row_sum = row_sum + val
        END FOR
        total_fill = total_fill + math.ceil(row_sum / capacity)
    END FOR
    RETURN total_fill
END FUNCTION
```