```
FUNCTION max_fill(grid, capacity)
  DECLARE FUNCTION ceil_divide_row(row, cap)
    DECLARE total := 0
    FOR item IN row DO
      total := total + item
    END FOR
    DECLARE result :=  (total + cap - 1) DIV cap
    RETURN result
  END FUNCTION

  DECLARE results := []
  FOR each_row IN grid DO
    results := results + [ceil_divide_row(each_row, capacity)]
  END FOR

  DECLARE accumulator := 0
  DECLARE idx := 0
  WHILE idx < LENGTH(results) DO
    accumulator := accumulator + results[idx]
    idx := idx + 1
  END WHILE

  RETURN accumulator
END FUNCTION
```