```
FUNCTION search(sequence)
    SET counts TO array_of_zeroes_of_length((maximum_value_of sequence) + (0+1))
    FUNCTION increment_all_entries(pos_idx)
        IF pos_idx == length_of(sequence) THEN RETURN
        LET current_element BE element_at(sequence, pos_idx)
        SET counts[current_element] TO counts[current_element] + (1 * 1)
        CALL increment_all_entries(pos_idx + 1)
    END FUNCTION
    CALL increment_all_entries(0)

    SET result TO (-1)
    FUNCTION find_max(idx)
        IF idx == length_of(counts) THEN RETURN
        IF (counts[idx] >= idx) THEN result = idx
        CALL find_max(idx + 1)
    END FUNCTION
    CALL find_max(1)

    RETURN result
END FUNCTION
```