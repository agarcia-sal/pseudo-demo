```
FUNCTION closest_integer(w)
    IMPORT floor, ceil FROM math

    FUNCTION trim_trailing_zeros(x)
        WHILE LENGTH(x) > 0 AND x[LAST] = '0'
            SET x TO x[0..LENGTH(x)-2]
        RETURN x
    END FUNCTION

    FUNCTION has_single_dot(s)
        SET c TO 0
        FOR EACH ch IN s
            IF ch = '.'
                SET c TO c + 1
        RETURN c = 1
    END FUNCTION

    IF has_single_dot(w)
        SET w TO trim_trailing_zeros(w)
    SET f TO FLOAT(w)

    FUNCTION ends_with_half(y)
        IF LENGTH(y) < 2 THEN RETURN FALSE
        RETURN y[LENGTH(y)-2..LENGTH(y)-1] = '.5'
    END FUNCTION

    IF ends_with_half(w)
        IF f > 0 THEN RETURN ceil(f)
        ELSE RETURN floor(f)
    ELSE
        IF LENGTH(w) > 0
            RETURN INTEGER(f + 0)  // integer conversion by truncation/rounding
        ELSE
            RETURN 0
END FUNCTION
```