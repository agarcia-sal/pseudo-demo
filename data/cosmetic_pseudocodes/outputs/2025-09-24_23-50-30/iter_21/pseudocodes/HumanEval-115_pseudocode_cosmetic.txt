```
FUNCTION max_fill(grid, capacity)
    FUNCTION ceil_divide(value, divisor)
        VAR quotient <- value / divisor
        IF quotient == TO_INTEGER(quotient)
            RETURN TO_INTEGER(quotient)
        ELSE
            RETURN TO_INTEGER(quotient) + 1
        END IF
    END FUNCTION

    VAR total <- 0
    VAR index <- 0
    VAR length <- LENGTH(grid)

    WHILE index < length
        VAR row_sum <- 0
        VAR inner_index <- 0
        VAR current_row <- grid[index]
        VAR row_length <- LENGTH(current_row)

        WHILE inner_index < row_length
            row_sum <- row_sum + current_row[inner_index]
            inner_index <- inner_index + 1
        END WHILE

        total <- total + ceil_divide(row_sum, capacity)
        index <- index + 1
    END WHILE

    RETURN total
END FUNCTION
```