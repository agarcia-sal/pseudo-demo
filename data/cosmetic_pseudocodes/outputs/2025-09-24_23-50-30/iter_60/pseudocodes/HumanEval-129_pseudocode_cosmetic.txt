```
FUNCTION minPath(M, q)
    SET S TO LENGTH OF M
    SET T TO (S * S) + 1

    PROCEDURE loop_over_rows(x)
        IF x >= S THEN RETURN
        PROCEDURE loop_over_cols(y)
            IF y >= S THEN RETURN
            IF M[x][y] == 1 THEN
                SET Z TO []
                IF NOT (x == 0) THEN Z APPEND M[x-1][y] END IF
                IF NOT (y == 0) THEN Z APPEND M[x][y-1] END IF
                IF NOT (x == S-1) THEN Z APPEND M[x+1][y] END IF
                IF NOT (y == S-1) THEN Z APPEND M[x][y+1] END IF
                SET T TO MINIMUM ELEMENT OF Z
            END IF
            CALL loop_over_cols(y + 1)
        END PROCEDURE
        CALL loop_over_cols(0)
        CALL loop_over_rows(x + 1)
    END PROCEDURE

    CALL loop_over_rows(0)

    SET A TO []
    PROCEDURE build_result(r)
        IF r >= q THEN RETURN
        IF ((r % 2) == 0) THEN A APPEND 1
        ELSE A APPEND T
        END IF
        CALL build_result(r + 1)
    END PROCEDURE

    CALL build_result(0)
    RETURN A
END FUNCTION
```