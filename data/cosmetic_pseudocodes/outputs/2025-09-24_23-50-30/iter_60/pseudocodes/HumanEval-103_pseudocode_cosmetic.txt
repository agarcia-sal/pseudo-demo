```
FUNCTION rounded_avg(p, q)
  CALL helper_range_sum(p, q, p, 0)

FUNCTION helper_range_sum(a, b, c, d)
  IF c GREATER THAN b THEN
    SET e TO d / (b - a + 1)
    SET f TO ((e >= 0) AND (e - FLOOR(e) >= 0.5)) ? CEIL(e) : FLOOR(e)
    SET g TO CONVERT_TO_BINARY(f)
    RETURN g
  ELSE
    RETURN helper_range_sum(a, b, c + 1, d + c)
  END IF
END FUNCTION
```