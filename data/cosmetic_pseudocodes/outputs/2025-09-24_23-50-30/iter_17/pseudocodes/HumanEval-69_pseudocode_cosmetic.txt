```
FUNCTION search(array_of_numbers)
    VAR counts_map := dictionary defaulting to 0
    FOR each element IN array_of_numbers DO
        counts_map[element] := counts_map[element] + 1
    VAR result := -1
    VAR keys_list := list of keys in counts_map
    VAR max_key := 0
    FOR each key IN keys_list DO
        IF key > max_key THEN
            max_key := key
    FOR candidate FROM max_key DOWNTO 1 DO
        IF counts_map[candidate] >= candidate THEN
            result := candidate
            BREAK
    RETURN result
END FUNCTION
```