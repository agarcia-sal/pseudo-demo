```
FUNCTION max_fill(grid, capacity)
    VAR total_count <- 0
    VAR index <- 0
    WHILE index < LENGTH(grid) DO
        VAR current_sum <- 0
        VAR j <- 0
        WHILE j < LENGTH(grid[index]) DO
            current_sum <- current_sum PLUS grid[index][j]
            j <- j PLUS 1
        END WHILE
        VAR division_result <- current_sum DIVIDED_BY capacity
        VAR division_integral <- INTEGER_PART_OF(division_result)
        VAR division_fraction <- division_result MINUS division_integral
        VAR ceiling_value <- IF division_fraction GREATER_THAN 0 THEN division_integral PLUS 1 ELSE division_integral
        total_count <- total_count PLUS ceiling_value
        index <- index PLUS 1
    END WHILE
    RETURN total_count
END FUNCTION
```