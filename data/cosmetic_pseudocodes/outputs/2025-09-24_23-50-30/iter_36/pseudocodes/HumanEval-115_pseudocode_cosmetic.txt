```
FUNCTION max_fill(grid, cap)
    IMPORT math
    FUNCTION compute(row_list, acc_total)
        IF row_list IS EMPTY THEN
            RETURN acc_total
        ELSE
            LET first_row = row_list[0]
            LET others = row_list[1:]
            LET row_sum = 0
            FOR each el IN first_row DO
                SET row_sum = row_sum + el
            END FOR
            LET division_result = row_sum / cap
            LET ceiling_val = math ceiling of division_result
            RETURN compute(others, acc_total + ceiling_val)
        END IF
    END FUNCTION
    RETURN compute(grid, 0)
END FUNCTION
```