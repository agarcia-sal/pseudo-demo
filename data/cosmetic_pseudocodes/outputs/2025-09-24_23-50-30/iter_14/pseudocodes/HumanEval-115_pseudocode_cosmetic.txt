```
FUNCTION max_fill(grid, capacity)
    total_cells ← 0
    index ← 0
    WHILE index < LENGTH(grid)
        accumulator ← 0
        cell_index ← 0
        row_data ← grid[index]
        WHILE cell_index < LENGTH(row_data)
            accumulator ← accumulator + row_data[cell_index]
            cell_index ← cell_index + 1
        END WHILE
        total_cells ← total_cells + ((accumulator + capacity - 1) DIV capacity)
        index ← index + 1
    END WHILE
    RETURN total_cells
END FUNCTION
```