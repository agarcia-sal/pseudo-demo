```
FUNCTION max_fill(grid, capacity)
    VARIABLE total_fill <- 0
    VARIABLE idx <- 0
    WHILE idx < LENGTH(grid)
        VARIABLE row_sum <- 0
        VARIABLE col_idx <- 0
        WHILE col_idx < LENGTH(grid[idx])
            SET row_sum <- row_sum + grid[idx][col_idx]
            SET col_idx <- col_idx + 1
        END WHILE
        VARIABLE div_res <- row_sum DIV capacity
        IF div_res * capacity < row_sum
            SET div_res <- div_res + 1
        END IF
        SET total_fill <- total_fill + div_res
        SET idx <- idx + 1
    END WHILE
    RETURN total_fill
END FUNCTION
```