```
FUNCTION max_fill(grid, capacity)
    SET accumulator TO 0
    FOR EACH line IN grid DO
        SET total TO 0
        FOR EACH element IN line DO
            total = total + element
        END FOR
        SET fragment TO total / capacity
        IF fragment IS NOT AN INTEGER THEN
            fragment = INTEGER PART OF fragment + 1
        ELSE
            fragment = INTEGER PART OF fragment
        END IF
        accumulator = accumulator + fragment
    END FOR
    RETURN accumulator
END FUNCTION
```