```
FUNCTION max_fill(grid, capacity)
    SET import_math TO TRUE
    SET total TO 0
    FOR EACH row IN grid DO
        SET row_sum TO 0
        FOR EACH element IN row DO
            row_sum = row_sum + element
        END FOR
        SET value TO row_sum / capacity
        SET ceil_value TO value
        IF value IS NOT EQUAL TO INTEGER PART OF value THEN
            ceil_value = INTEGER PART OF value + 1
        ELSE
            ceil_value = value
        END IF
        total = total + ceil_value
    END FOR
    RETURN total
END FUNCTION
```