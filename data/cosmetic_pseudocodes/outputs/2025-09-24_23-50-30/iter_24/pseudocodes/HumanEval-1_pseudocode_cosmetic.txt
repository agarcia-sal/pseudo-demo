```
FUNCTION separate_paren_groups(q)
  LET u = []
  LET v = []
  LET w = 0

  FUNCTION process_index(x)
    IF x > LENGTH(q) THEN
      RETURN
    END IF
    
    LET y = q[x]

    IF y = ')' THEN
      LET w = w - 1
      CALL append_and_check(y)
    ELSE IF NOT (y = ')') THEN
      IF NOT (y <> '(') THEN
        LET w = w + 1
      END IF
      CALL append_and_check(y)
    END IF
    
    CALL process_index(x + 1)
  END FUNCTION

  FUNCTION append_and_check(z)
    INSERT z INTO v
    IF w = 0 THEN
      INSERT JOINED(v) INTO u
      CLEAR v
    END IF
  END FUNCTION

  CALL process_index(1)

  RETURN u
END FUNCTION
```