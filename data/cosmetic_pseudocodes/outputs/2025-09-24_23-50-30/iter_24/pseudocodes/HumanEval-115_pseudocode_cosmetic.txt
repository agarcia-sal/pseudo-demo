```
FUNCTION max_fill(grid, capacity)
    DECLARE result_list ← EMPTY LIST
    DECLARE idx ← 0
    WHILE idx < LENGTH OF grid
        DECLARE temp_row ← grid[idx]
        DECLARE accum ← 0
        DECLARE jdx ← 0
        WHILE jdx < LENGTH OF temp_row
            accum ← accum + temp_row[jdx]
            jdx ← jdx + 1
        END WHILE
        DECLARE division ← accum / capacity
        DECLARE ceiling_value ← division
        IF ceiling_value <> (accum / capacity)
            ceiling_value ← INTEGER_PART_OF(division) + 1
        END IF
        APPEND ceiling_value TO result_list
        idx ← idx + 1
    END WHILE
    DECLARE total ← 0
    DECLARE kdx ← 0
    WHILE kdx < LENGTH OF result_list
        total ← total + result_list[kdx]
        kdx ← kdx + 1
    END WHILE
    RETURN total
END FUNCTION
```