```
FUNCTION median(arr)
    DEFINE FUNCTION sorted_array(seq)
        IF LENGTH seq <= 1 THEN RETURN seq
        SET pivot TO seq[0]
        SET less TO [x FOR x IN seq IF x < pivot]
        SET equal TO [x FOR x IN seq IF x = pivot]
        SET greater TO [x FOR x IN seq IF x > pivot]
        RETURN sorted_array(less) + equal + sorted_array(greater)
    END FUNCTION

    SET values TO sorted_array(arr)
    SET total TO LENGTH values
    DEFINE FUNCTION compute_median(index)
        IF (total % 2) = 1 THEN
            RETURN values[index]
        ELSE
            SET a TO values[index - 1]
            SET b TO values[index]
            RETURN (a + b) / 2.0
    END FUNCTION

    RETURN compute_median(total / 2)
END FUNCTION
```