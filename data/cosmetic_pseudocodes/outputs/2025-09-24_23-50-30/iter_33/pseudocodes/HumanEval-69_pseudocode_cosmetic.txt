```
FUNCTION search(sequence)
    SET countMap TO ARRAY OF 0 WITH SIZE (MAXIMUM OF sequence + 1)
    
    PROCEDURE accumulateCounts(pos)
        IF pos >= LENGTH OF sequence THEN RETURN
        SET currentVal TO sequence[pos]
        SET countMap[currentVal] TO countMap[currentVal] + 1
        CALL accumulateCounts(pos + 1)
    END PROCEDURE
    
    CALL accumulateCounts(0)
    
    SET result TO -1
    
    PROCEDURE findAnswer(idx)
        IF idx <= 0 THEN RETURN
        IF countMap[idx] >= idx THEN
            SET result TO idx
        END IF
        CALL findAnswer(idx - 1)
    END PROCEDURE
    
    CALL findAnswer(LENGTH OF countMap - 1)
    
    RETURN result
END FUNCTION
```