```
FUNCTION max_fill(grid, capacity)
    VAR index <- 0
    VAR total_sum <- 0
    WHILE index < LENGTH(grid)
        VAR row_sum <- 0
        FOR EACH element IN grid[index]
            row_sum := row_sum + element
        END FOR
        total_sum := total_sum + ((row_sum + capacity - 1) DIV capacity)
        index := index + 1
    END WHILE
    RETURN total_sum
END FUNCTION
```