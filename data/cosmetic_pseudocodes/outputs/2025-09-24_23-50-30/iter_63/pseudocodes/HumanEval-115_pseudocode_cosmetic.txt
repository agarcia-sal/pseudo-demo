```
FUNCTION max_fill(grid, capacity)
  IMPORT math
  VAR total_fill <- 0
  FOR each_row IN grid DO
    VAR row_total <- 0
    FOR element IN each_row DO
      row_total <- row_total + element
    END FOR
    VAR partial <- math ceiling(row_total / capacity)
    total_fill <- total_fill + partial
  END FOR
  RETURN total_fill
END FUNCTION
```