```
FUNCTION max_fill(grid, capacity)
    IMPORT math
    DEFINE FUNCTION aux(index, total)
        IF index >= LENGTH(grid) THEN
            RETURN total
        ELSE
            LET row_sum = 0
            LET counter = 0
            WHILE counter < LENGTH(grid[index])
                row_sum = row_sum + grid[index][counter]
                counter = counter + 1
            END WHILE
            RETURN aux(index + 1, total + math.ceil(row_sum / capacity))
        END IF
    END FUNCTION
    RETURN aux(0, 0)
END FUNCTION
```