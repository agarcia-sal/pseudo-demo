```
FUNCTION max_fill(grid, capacity)
    IMPORT math
    VAR index <- 0
    VAR acc <- 0
    VAR data <- grid
    VAR n <- LENGTH(data)
    WHILE index < n DO
        VAR tempSum <- 0
        VAR pos <- 0
        VAR row <- data[index]
        VAR m <- LENGTH(row)
        REPEAT
            IF pos >= m THEN
                BREAK
            END IF
            tempSum <- tempSum + row[pos]
            pos <- pos + 1
        UNTIL FALSE
        acc <- acc + (math.ceiling(tempSum / capacity))
        index <- index + 1
    END WHILE
    RETURN acc
END FUNCTION
```