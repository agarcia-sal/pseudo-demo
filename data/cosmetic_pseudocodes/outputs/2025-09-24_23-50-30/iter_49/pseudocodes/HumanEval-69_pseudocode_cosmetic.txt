```
FUNCTION search(sequence)
    FUNCTION tally(counter, elements)
        IF elements IS EMPTY THEN RETURN counter ENDIF
        LET head_element = elements[0]
        LET tail_elements = elements[1 TO END]
        LET updated_counter = counter
        updated_counter[head_element] ← updated_counter[head_element] + 1
        RETURN tally(updated_counter, tail_elements)
    END FUNCTION

    LET maximum_value = 0
    FOR i FROM 0 TO LENGTH(sequence) - 1 DO
        IF sequence[i] > maximum_value THEN maximum_value ← sequence[i] ENDIF
    END FOR

    LET histogram ← array_of_zeroes WITH LENGTH maximum_value + 1
    LET result ← -1

    LET filled_histogram = tally(histogram, sequence)

    FOR position IN 1 TO LENGTH(filled_histogram) - 1 DO
        IF filled_histogram[position] >= position THEN
            result ← position
        ENDIF
    END FOR

    RETURN result
END FUNCTION
```