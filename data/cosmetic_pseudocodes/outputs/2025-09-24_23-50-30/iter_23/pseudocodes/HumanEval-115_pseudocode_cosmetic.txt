```
FUNCTION max_fill(grid, capacity)
import math

LET process_row = (lst) => 
    math.ceiling(SUM(lst) / capacity)

LET transformed_rows = []
FOR row_index FROM 0 TO LENGTH(grid) - 1
    transformed_rows APPEND process_row(grid[row_index])
END FOR

LET total = 0
LET idx = 0
WHILE idx < LENGTH(transformed_rows)
    total = total + transformed_rows[idx]
    idx = idx + 1
END WHILE

RETURN total
END FUNCTION
```