```
FUNCTION is_happy(q)
  IF NOT (3 <= LENGTH OF q)
    RETURN False
  END IF

  FUNCTION rec(p, r)
    SWITCH (r >= LENGTH OF p - 2)
      CASE True:
        RETURN True
      DEFAULT:
        SWITCH NOT (
           (p[r] = p[r + 1]) OR
           (p[r + 1] = p[r + 2]) OR
           (p[r] = p[r + 2])
        )
          CASE True:
            RETURN rec(p, r + 1)
          DEFAULT:
            RETURN False
        END SWITCH
    END SWITCH
  END FUNCTION

  RETURN rec(q, 0)
END FUNCTION
```