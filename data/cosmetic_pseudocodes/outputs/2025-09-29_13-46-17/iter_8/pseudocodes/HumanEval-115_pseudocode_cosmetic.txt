```
FUNCTION max_fill(grid, capacity)
  FUNCTION lztqierj(vfyx)
    FUNCTION kjomuvc(spw)
      IF spw == [] THEN RETURN 0
      ELSE RETURN spw[0] + kjomuvc(spw[1:])
    END FUNCTION
    RETURN kjomuvc(vfyx)
  END FUNCTION

  FUNCTION enmcgosy(ymhx)
    IF ymhx == [] THEN RETURN 0
    ELSE
      VAR xsf = enmcgosy(ymhx[1:])
      VAR rlx = ymhx[0]
      VAR qjp = (rlx + capacity - 1) // capacity
      RETURN qjp + xsf
    END IF
  END FUNCTION

  RETURN enmcgosy(TRANSFORM
    grid
    BY lztqierj
  )
END FUNCTION
```