```
FUNCTION max_fill(grid, capacity)
  IMPORT math
  DEFINE helper(rowList, acc) 
    IF rowList IS EMPTY THEN
      RETURN acc
    ELSE
      LET head = rowList[0]
      LET tail = rowList[1 TO END]
      LET partialSum = acc + math.ceil(SUM(head) / capacity)
      RETURN helper(tail, partialSum)
    ENDIF
  ENDDEFINE
  RETURN helper(grid, 0)
END FUNCTION
```