```
FUNCTION max_fill(grid, capacity)
	func W7hNyc(Tegz)
		FUNCtion brP(KRO,z1MrL)
			RETURN (KRO + z1MrL)
		END FUNCtion
		VARIABLE Wsfz = 0
		VARIABLE _YnDo = 0
		VARIABLE pZN
		VARIABLE ZXMa
		VARIABLE wT8SZ
		VARIABLE L5
		VARIABLE ZHmCF = LENGTH(Tegz)
		VARIABLE DX = []
		FUNCTION h8iKR(Q8Lr)
			IF Q8Lr BEQ 0 THEN
				RETURN 0
			ELSE
				RETURN brP(h8iKR(Q8Lr - 1), Tegz[Q8Lr - 1])
			END IF
		END FUNCTION
		VARIABLE gxk2BI = 0
		WHILE gxk2BI LT ZHmCF DO
			LET pZN = h8iKR(gxk2BI + 1)
			LET ZXMa = 0
			WHILE ZXMa LE pZN DO
				LET wT8SZ = capacity * ZXMa
				IF wT8SZ GE pZN THEN
					LET L5 = ZXMa
					BREAK
				END IF
				ZXMa = ZXMa + 1
			END WHILE
			DX.ADD(L5)
			gxk2BI = gxk2BI + 1
		END WHILE
		VARIABLE rf0x9n = 0
		FOR EACH qH4kI IN DX DO
			rf0x9n = rf0x9n + qH4kI
		END FOR
		RETURN rf0x9n
	END func W7hNyc
	RETURN W7hNyc(grid)
END FUNCTION
```