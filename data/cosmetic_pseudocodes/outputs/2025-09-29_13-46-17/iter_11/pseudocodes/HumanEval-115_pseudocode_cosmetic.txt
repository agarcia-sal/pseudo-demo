```
FUNCTION max_fill(grid, capacity)
	DEFINE θ₇XJ2(S⊗) 
		  IF NOT (S⊗ = []) THEN
			  LET Μϙ ← LENGTH(S⊗)
			  LET λκ₁z ← 0
			  FUNCTION ϝε₇(Qpσ, Nmȷ)
				  IF NOT (Nmȷ = Μϙ) THEN
					  LET Δ₀ ← Qpσ + S⊗[Nmȷ]
					  RETURN ϝε₇(Δ₀, Nmȷ + 1)
				  ELSE
					  RETURN Qpσ
				  END IF
			  END FUNCTION
			  LET ηΓχ ← ϝε₇(0, 0)
			  RETURN ηΓχ
		  ELSE
			  RETURN 0
		  END IF
	END DEFINE
	DEFINE κø₉(Ω*)
		IF NOT (Ω* = []) THEN
			LET υ₃ψ ← Ω*[0]
			LET κ於 ← Ω*[1 TO END]
			RETURN υ₃ψ + κø₉(κ於)
		ELSE
			RETURN 0
		END IF
	END DEFINE
	DEFINE Пβλ(Ξ, ϰ)
		LET υφ₆ ← НЕG(НЕG(Ξ ≥ 0) ∧ (НЕ(Ξ = 0))) ? 1 : 0
		IF υφ₆ = 1 THEN
			RETURN 1 + Пβλ(Ξ - 1, ϰ)
		ELSE
			RETURN 0
		END IF
	END DEFINE
	DEFINE Fᾶν(ϞΔ)
		IF ϞΔ = 0 THEN RETURN 0 END IF
		LET Ζ₁ ← 1
		LET ψλ₇ ← Пβλ(ϞΔ - 1, 0)
		RETURN Ζ₁ + ψλ₇
	END DEFINE
	DEFINE ΦₗₛΘ(βΨ, ιɲ)
		LET ζξ ← LENGTH(βΨ)
		FUNCTION ψΩσ(κƛ, Θι)
			IF Θι ≥ ζξ THEN RETURN κƛ END IF
			LET ʝҨ ← βΨ[Θι]
			LET ƥϿ ← κø₉([ʝҨ])
			LET δᶊ ← Fᾶν( (ƒ) => (ƒ * 1), ASR( (ƥϿ + ιɲ - 1) / ιɲ ) )
			RETURN ψΩσ(κƛ + δᶊ, Θι + 1)
		END FUNCTION
		RETURN ψΩσ(0, 0)
	END DEFINE
	RETURN ΦₗₛΘ(grid, capacity)
END FUNCTION
```