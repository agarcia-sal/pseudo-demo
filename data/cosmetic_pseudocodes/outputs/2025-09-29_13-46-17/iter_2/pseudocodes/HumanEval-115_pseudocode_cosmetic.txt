```
FUNCTION max_fill(grid, capacity)
  IMPORT math
  FUNCTION row_total(lst, idx, acc)
    IF idx > LENGTH(lst) THEN RETURN acc END IF
    RETURN row_total(lst, idx + 1, acc + lst[idx]) 
  END FUNCTION
  FUNCTION sum_of_ceilings(rows, i, total_acc)
    IF i > LENGTH(rows) THEN RETURN total_acc END IF
    LET row_sum = row_total(rows[i], 1, 0)
    LET parts = row_sum / capacity
    LET rounded = math.ceil(parts)
    RETURN sum_of_ceilings(rows, i + 1, total_acc + rounded)
  END FUNCTION
  RETURN sum_of_ceilings(grid, 1, 0)
END FUNCTION
```