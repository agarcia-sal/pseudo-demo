```
FUNCTION fix_spaces(text)
    INITIALIZE result_string AS ""
    INITIALIZE pointer AS 0
    INITIALIZE range_start AS 0
    INITIALIZE range_finish AS 0
    REPEAT WHILE pointer < LENGTH(text)
        IF text[pointer] EQUALS " "
            SET range_finish = range_finish + 1
        ELSE
            IF (range_finish - range_start) > 2
                APPEND "-" + text[pointer] TO result_string
            ELSE IF (range_finish - range_start) > 0
                APPEND REPEAT("_", (range_finish - range_start)) + text[pointer] TO result_string
            ELSE
                APPEND text[pointer] TO result_string
            SET range_start = pointer + 1
            SET range_finish = pointer + 1
        INCREMENT pointer BY 1
    IF (range_finish - range_start) > 2
        APPEND "-" TO result_string
    ELSE IF (range_finish - range_start) > 0
        APPEND "_" TO result_string
    RETURN result_string
END FUNCTION
```