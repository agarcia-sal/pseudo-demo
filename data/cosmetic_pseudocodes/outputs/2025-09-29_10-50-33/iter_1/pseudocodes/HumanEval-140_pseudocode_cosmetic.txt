```
FUNCTION fix_spaces(text)
    LET new_text BE ""
    LET start BE 0
    LET end BE 0
    LET index BE 0

    REPEAT WHILE index < LENGTH(text)
        LET char IS text[index]
        IF char = " " THEN
            end = end + 1
        ELSE
            LET gap = end - start
            IF gap > 2 THEN
                new_text = new_text + "-" + char
            ELSE IF gap > 0 THEN
                new_text = new_text + REPEAT("_", gap) + char
            ELSE
                new_text = new_text + char
            END IF
            start = index + 1
            end = index + 1
        END IF
        index = index + 1
    END REPEAT

    LET remainder = end - start
    IF remainder > 2 THEN
        new_text = new_text + "-"
    ELSE IF remainder > 0 THEN
        new_text = new_text + "_"
    END IF

    RETURN new_text
END FUNCTION
```