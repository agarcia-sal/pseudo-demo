FUNCTION fix_spaces(text)
	new_text := ""
	start_pos := 0
	scan_index := 0
	trail_index := 0
	
	REPEAT
	IF NOT (scan_index < LENGTH(text)) THEN BREAK
	
		IF text[scan_index] = " " THEN
			trail_index := trail_index + 1
			
		ELSE
			space_span := trail_index - start_pos
			IF space_span > 2 THEN
				new_text := new_text + "-" + text[scan_index]
			ELSE IF space_span > 0 THEN
				new_text := new_text + REPEAT("_", space_span) + text[scan_index]
			ELSE
				new_text := new_text + text[scan_index]
			start_pos := scan_index + 1
			trail_index := scan_index + 1
		scan_index := scan_index + 1
	UNTIL FALSE
	
	final_span := trail_index - start_pos
	IF final_span > 2 THEN
		new_text := new_text + "-"
	ELSE IF final_span > 0 THEN
		new_text := new_text + "_"
	
	EXECUTE new_text
END FUNCTION