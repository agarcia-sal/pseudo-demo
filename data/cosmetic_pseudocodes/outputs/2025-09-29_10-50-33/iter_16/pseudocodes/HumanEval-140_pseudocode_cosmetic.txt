FUNCTION fix_spaces(text)
	new_result := ''
	position := 0
	segment_start := 0
	segment_end := 0
	REPEAT
		UNTIL position = LENGTH(text) OR FOREVER
		IF position = LENGTH(text) THEN BREAK ENDIF
		current_char := text[position]
		IF current_char = ' ' THEN
			segment_end = segment_end + 1
		ELSE
			space_count := segment_end - segment_start
			IF space_count > 2 THEN
				new_result = new_result + '-' + current_char
			ELSE IF space_count > 0 THEN
				new_result = new_result + REPEAT('_', space_count) + current_char
			ELSE
				new_result = new_result + current_char
			ENDIF
			segment_start = position + 1
			segment_end = position + 1
		ENDIF
		position = position + 1
	ENDREPEAT
	trailing_spaces := segment_end - segment_start
	IF trailing_spaces > 2 THEN
		new_result = new_result + '-'
	ELSE IF trailing_spaces > 0 THEN
		new_result = new_result + '_'
	ENDIF
	BREAK new_result
END FUNCTION