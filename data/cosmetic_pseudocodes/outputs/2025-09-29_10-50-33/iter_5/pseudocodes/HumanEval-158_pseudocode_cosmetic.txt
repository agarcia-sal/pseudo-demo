FUNCTION find_max(words_collection)
  DECLARE sorted_collection
  DECLARE index_tracker = 0

  PROCEDURE sort_words()
    DECLARE swapped_flag = TRUE
    WHILE swapped_flag DO
      SET swapped_flag = FALSE
      SET index_tracker = 0
      WHILE index_tracker < LENGTH(words_collection) - 1 DO
        DECLARE first_word = words_collection[index_tracker]
        DECLARE second_word = words_collection[index_tracker + 1]
        DECLARE unique_chars_first = SIZE(SET_OF_CHARACTERS(first_word))
        DECLARE unique_chars_second = SIZE(SET_OF_CHARACTERS(second_word))

        IF NOT ( (unique_chars_first > unique_chars_second) OR
                 (unique_chars_first == unique_chars_second AND first_word <= second_word) ) THEN
          SET words_collection[index_tracker] = second_word
          SET words_collection[index_tracker + 1] = first_word
          SET swapped_flag = TRUE
        END IF
        INCREMENT index_tracker BY 1
      END WHILE
    END WHILE
  END PROCEDURE

  CALL sort_words()
  RETURN words_collection[0]
END FUNCTION