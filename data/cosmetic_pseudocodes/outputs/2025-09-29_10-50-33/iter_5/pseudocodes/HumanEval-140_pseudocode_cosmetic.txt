FUNCTION fix_spaces(text)
  SET result_text = ""
  SET current_index = 0
  SET gap_start = 0
  SET gap_end = 0
  
  WHILE current_index < LENGTH(text) DO
    IF text[current_index] â‰  " " THEN
      IF gap_end - gap_start > 2 THEN
        result_text = result_text + "-" + text[current_index]
      ELSE
        IF gap_end - gap_start > 0 THEN
          result_text = result_text + REPEAT("_", gap_end - gap_start) + text[current_index]
        ELSE
          result_text = result_text + text[current_index]
        END IF
      END IF
      gap_end = current_index + 1
      gap_start = current_index + 1
    ELSE
      gap_end = gap_end + 1
    END IF
    current_index = current_index + 1
  END WHILE
  
  SET trailing_gap_length = gap_end - gap_start
  IF trailing_gap_length > 2 THEN
    result_text = result_text + "-"
  ELSE IF trailing_gap_length > 0 THEN
    result_text = result_text + "_"
  END IF
  
  RETURN result_text
END FUNCTION