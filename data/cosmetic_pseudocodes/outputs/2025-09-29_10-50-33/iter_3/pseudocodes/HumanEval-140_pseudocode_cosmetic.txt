FUNCTION fix_spaces(original_text)
  SET result_string TO ""
  SET position TO 0
  SET gap_start TO 0
  SET gap_finish TO 0

  REPEAT
    IF position >= LENGTH(original_text) THEN
      BREAK
    ENDIF

    IF original_text[position] = " " THEN
      SET gap_finish TO gap_finish + 1
    OTHERWISE
      IF (gap_finish - gap_start) > 2 THEN
        SET result_string TO result_string + "-" + original_text[position]
      ELSEIF (gap_finish - gap_start) > 0 THEN
        SET count_spaces TO gap_finish - gap_start
        SET underscore_sequence TO ""
        SET underscore_index TO 0
        WHILE underscore_index < count_spaces
          SET underscore_sequence TO underscore_sequence + "_"
          SET underscore_index TO underscore_index + 1
        ENDWHILE
        SET result_string TO result_string + underscore_sequence + original_text[position]
      ELSE
        SET result_string TO result_string + original_text[position]
      ENDIF
      SET gap_start TO position + 1
      SET gap_finish TO position + 1
    ENDIF

    SET position TO position + 1
  ENDREPEAT

  SET final_gap TO gap_finish - gap_start
  IF final_gap > 2 THEN
    SET result_string TO result_string + "-"
  ELSEIF final_gap > 0 THEN
    SET result_string TO result_string + "_"
  ENDIF

  RETURN result_string
END FUNCTION