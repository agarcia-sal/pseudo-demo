```
FUNCTION max_fill(grid, capacity)
    IMPORT math
    total = 0
    FOR EACH row IN grid DO
        row_sum = 0
        FOR EACH item IN row DO
            row_sum = row_sum + item
        END FOR
        total = total + math.ceil(row_sum / capacity)
    END FOR
    RETURN total
END FUNCTION
```