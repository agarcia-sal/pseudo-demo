```
FUNCTION max_fill(grid, capacity)
    IMPORT math
    DECLARE row_sum_list = EMPTY LIST
    DECLARE idx = 0
    REPEAT
        IF idx >= LENGTH(grid) THEN
            BREAK
        ENDIF
        DECLARE temp_sum = 0
        DECLARE elem_idx = 0
        REPEAT
            IF elem_idx >= LENGTH(grid[idx]) THEN
                BREAK
            ENDIF
            SET temp_sum = temp_sum + grid.at(idx).at(elem_idx)
            SET elem_idx = elem_idx + 1
        UNTIL FALSE
        APPEND temp_sum TO row_sum_list
        SET idx = idx + 1
    UNTIL FALSE
    DECLARE total_ceiled = 0
    DECLARE row_iter = 0
    WHILE row_iter < LENGTH(row_sum_list) DO
        DECLARE division_result = row_sum_list.at(row_iter) / capacity
        DECLARE ceiling_value = math.ceil(division_result)
        SET total_ceiled = total_ceiled + ceiling_value
        SET row_iter = row_iter + 1
    ENDWHILE
    RETURN total_ceiled
END FUNCTION
```