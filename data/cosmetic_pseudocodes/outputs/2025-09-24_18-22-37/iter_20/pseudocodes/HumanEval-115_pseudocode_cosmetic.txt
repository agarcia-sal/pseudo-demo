```
FUNCTION max_fill(grid, capacity)
  
  IMPORT math
  
  total_elements_count ← 0
  all_row_sums ← EMPTY LIST
  iterator_index ← 0
  max_fill_result ← 0
  
  WHILE iterator_index < LENGTH(grid)
    
    row_current ← grid[iterator_index]
    acc_row ← 0
    idx_col ← 0
    
    WHILE idx_col < LENGTH(row_current)
      
      acc_row ← acc_row + row_current[idx_col]
      idx_col ← idx_col + 1
      
    END WHILE
    
    APPEND all_row_sums WITH acc_row
    iterator_index ← iterator_index + 1
    
  END WHILE

  index_sum ← 0
  WHILE index_sum < LENGTH(all_row_sums)
    
    current_sum ← all_row_sums[index_sum]
    division_result ← current_sum / capacity
    ceil_value ← math ceiling(division_result)
    max_fill_result ← max_fill_result + ceil_value
    
    index_sum ← index_sum + 1
    
  END WHILE

  RETURN max_fill_result

END FUNCTION
```