```
FUNCTION max_fill(grid, capacity)
    IMPORT math
    DECLARE total_fillings <- 0
    DECLARE row_idx <- 0
    WHILE row_idx < grid.length DO
        DECLARE current_row <- grid.at(row_idx)
        DECLARE sum_row <- 0
        DECLARE elem_idx <- 0
        WHILE elem_idx < current_row.length DO
            sum_row <- sum_row + current_row.at(elem_idx)
            elem_idx <- elem_idx + 1
        END WHILE
        DECLARE fraction <- sum_row / capacity
        DECLARE rounded_up <- math.ceil(fraction)
        total_fillings <- total_fillings + rounded_up
        row_idx <- row_idx + 1
    END WHILE
    RETURN total_fillings
END FUNCTION
```