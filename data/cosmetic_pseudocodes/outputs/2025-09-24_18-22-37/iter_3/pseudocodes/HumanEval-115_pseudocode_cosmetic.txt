```
FUNCTION max_fill(grid, capacity)
    SET total = 0
    DEFINE rows AS grid
    FOR index FROM 0 TO LENGTH(rows) - 1 DO
        SET row_sum = 0
        SET elements = rows[index]
        SET i = 0
        WHILE i < LENGTH(elements) DO
            SET row_sum = row_sum + elements[i]
            SET i = i + 1
        END WHILE
        SET div_result = row_sum / capacity
        IF div_result = FLOOR(div_result) THEN
            SET ceil_value = FLOOR(div_result)
        ELSE
            SET ceil_value = FLOOR(div_result) + 1
        END IF
        SET total = total + ceil_value
    END FOR
    RETURN total
END FUNCTION
```