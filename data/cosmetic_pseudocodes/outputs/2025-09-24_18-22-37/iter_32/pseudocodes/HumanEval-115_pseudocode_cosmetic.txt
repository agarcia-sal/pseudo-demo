```
FUNCTION max_fill(grid, capacity)
    IMPORT math
    INITIALIZE total_sum TO 0
    FOR EACH row_element IN grid
        INITIALIZE row_accumulator TO 0
        SET index TO 0
        WHILE index < LENGTH(row_element)
            SET row_accumulator TO row_accumulator + row_element[index]
            INCREMENT index BY 1
        END WHILE
        SET ceil_value TO math ceiling of (row_accumulator / capacity)
        SET total_sum TO total_sum + ceil_value
    END FOR
    RETURN total_sum
END FUNCTION
```