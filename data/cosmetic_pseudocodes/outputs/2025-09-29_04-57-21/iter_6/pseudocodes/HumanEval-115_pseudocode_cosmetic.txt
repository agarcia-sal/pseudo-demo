```
FUNCTION max_fill(grid, capacity)
    IMPORT math
    total = 0
    FOR EACH row IN grid DO
        subtotal = 0
        FOR EACH element IN row DO
            subtotal = subtotal + element
        END FOR
        total = total + math.ceil(subtotal / capacity)
    END FOR
    RETURN total
END FUNCTION
```