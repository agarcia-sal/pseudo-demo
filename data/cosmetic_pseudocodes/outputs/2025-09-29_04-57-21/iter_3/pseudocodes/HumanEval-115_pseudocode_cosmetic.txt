```
FUNCTION max_fill(grid, capacity)
    IMPORT math
    VARIABLE totalCapacityNeeded = 0
    FOR EACH row IN grid DO
        VARIABLE rowSum = 0
        FOR EACH element IN row DO
            rowSum = rowSum + element
        END FOR
        VARIABLE fillsForRow = math ceiling(rowSum / capacity)
        totalCapacityNeeded = totalCapacityNeeded + fillsForRow
    END FOR
    RETURN totalCapacityNeeded
END FUNCTION
```