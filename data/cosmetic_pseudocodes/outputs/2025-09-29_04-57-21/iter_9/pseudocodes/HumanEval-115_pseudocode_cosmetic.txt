```
FUNCTION max_fill(grid, capacity)
    IMPORT math
    total_fill = 0
    index = 0
    WHILE index < LENGTH(grid) DO
        row_sum = 0
        FOR element IN grid[index] DO
            row_sum = row_sum + element
        END FOR
        fill_value = math.ceil(row_sum / capacity)
        total_fill = total_fill + fill_value
        index = index + 1
    END WHILE
    RETURN total_fill
END FUNCTION
```