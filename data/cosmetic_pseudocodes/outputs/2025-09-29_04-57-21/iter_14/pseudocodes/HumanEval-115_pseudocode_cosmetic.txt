```
FUNCTION max_fill(grid, capacity)
    IMPORT math
    DECLARE accumulator = 0
    DECLARE i = 0
    WHILE i < LENGTH(grid)
        DECLARE current_row = grid[i]
        DECLARE total_in_row = 0
        DECLARE j = 0
        WHILE j < LENGTH(current_row)
            total_in_row = total_in_row + current_row[j]
            j = j + 1
        END WHILE
        DECLARE factor = total_in_row / capacity
        DECLARE ceiling_value = math.ceiling(factor)
        accumulator = accumulator + ceiling_value
        i = i + 1
    END WHILE
    RETURN accumulator
END FUNCTION
```