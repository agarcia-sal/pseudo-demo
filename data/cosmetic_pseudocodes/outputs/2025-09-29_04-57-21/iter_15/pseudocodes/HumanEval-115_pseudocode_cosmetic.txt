```
FUNCTION max_fill(grid, capacity)
    IMPORT math
    SET total_fill TO 0
    FOR EACH row IN grid DO
        SET row_sum TO 0
        FOR EACH cell IN row DO
            SET row_sum TO row_sum + cell
        END FOR
        SET fills_needed TO math ceiling(row_sum / capacity)
        SET total_fill TO total_fill + fills_needed
    END FOR
    RETURN total_fill
END FUNCTION
```