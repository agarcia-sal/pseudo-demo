```
FUNCTION max_fill(grid, capacity)
    IMPORT math
    DEFINE total AS 0
    SET row_index TO 0
    WHILE row_index < LENGTH(grid)
        DEFINE current_row AS grid[row_index]
        DEFINE row_sum AS 0
        DEFINE element_index AS 0
        WHILE element_index < LENGTH(current_row)
            SET row_sum TO row_sum + current_row[element_index]
            SET element_index TO element_index + 1
        END WHILE
        SET total TO total + math.ceil(row_sum / capacity)
        SET row_index TO row_index + 1
    END WHILE
    RETURN total
END FUNCTION
```