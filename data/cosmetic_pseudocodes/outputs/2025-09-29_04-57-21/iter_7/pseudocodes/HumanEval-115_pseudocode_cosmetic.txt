```
FUNCTION max_fill(grid, capacity)
    IMPORT math
    total_sum := 0
    idx := 0
    WHILE idx < LENGTH(grid)
        current_line := grid[idx]
        line_total := 0
        FOR element IN current_line
            line_total := line_total + element
        END FOR
        increment := math ceiling(line_total / capacity)
        total_sum := total_sum + increment
        idx := idx + 1
    END WHILE
    RETURN total_sum
END FUNCTION
```