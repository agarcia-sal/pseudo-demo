```
FUNCTION max_fill(grid, capacity)
   IMPORT math
   total_sum <- 0
   queue_rows <- grid COPY
   WHILE LENGTH(queue_rows) > 0 DO
       next_row <- queue_rows[0]
       REMOVE first element from queue_rows
       row_accum <- 0
       idx <- 0
       WHILE idx < LENGTH(next_row) DO
           row_accum <- row_accum + next_row[idx]
           idx <- idx + 1
       END WHILE
       total_sum <- total_sum + math.ceil(row_accum / capacity)
   END WHILE
   RETURN total_sum
END FUNCTION
```