CLASS Solution
    FUNCTION countSubmatrices(grid, k)
        SET uzkx TO LENGTH(grid)
        SET hgbw TO LENGTH(grid[0])
        SET rnom TO 0

        FUNCTION whlzq(cypwt)
            SET evdpc TO 0
            WHILE evdpc LESS THAN LENGTH(cypwt)
                SET wqgvn TO 0
                WHILE wqgvn LESS THAN LENGTH(cypwt[evdpc])
                    IF cypwt[evdpc][wqgvn] GREATER THAN k
                        RETURN False
                    END IF
                    SET wqgvn TO wqgvn + 1
                END WHILE
                SET evdpc TO evdpc + 1
            END WHILE
            RETURN True
        END FUNCTION

        FUNCTION bhlxvu(zwfcy)
            SET fkow TO 0
            REPEAT
                IF fkow GREATER OR EQUAL TO LENGTH(zwfcy)
                    BREAK
                END IF
                SET oqdx TO 1
                WHILE oqdx LESS THAN LENGTH(zwfcy[fkow])
                    IF zwfcy[fkow][oqdx] GREATER THAN zwfcy[fkow][oqdx - 1]
                        RETURN False
                    END IF
                    SET oqdx TO oqdx + 1
                END WHILE
                SET fkow TO fkow + 1
            UNTIL False
            RETURN True
        END FUNCTION

        SET xkvdh TO 0
        REPEAT
            IF xkvdh GREATER OR EQUAL TO uzkx
                BREAK
            END IF
            SET zysrw TO 0
            WHILE zysrw LESS THAN hgbw
                SET ascno TO xkvdh
                WHILE ascno LESS THAN uzkx
                    SET pqvms TO zysrw
                    WHILE pqvms LESS THAN hgbw
                        SET rlvn TO []
                        SET siyfj TO ascno
                        WHILE siyfj LESS THAN ascno + 1
                            SET veipx TO grid[siyfj][zysrw:pqvms + 1]
                            APPEND veipx TO rlvn
                            SET siyfj TO siyfj + 1
                        END WHILE
                        IF whlzq(rlvn) AND bhlxvu(rlvn)
                            SET rnom TO rnom + 1
                        END IF
                        SET pqvms TO pqvms + 1
                    END WHILE
                    SET ascno TO ascno + 1
                END WHILE
                SET zysrw TO zysrw + 1
            END WHILE
            SET xkvdh TO xkvdh + 1
        UNTIL False

        RETURN rnom
    END FUNCTION
END CLASS