CLASS Solution
    FUNCTION maximumEnergy(energy, k)
        SET a TO LENGTH(energy)
        SET b TO ARRAY FILLED WITH 0 OF SIZE a
        SET b[a - 1] TO energy[a - 1]
        SET c TO b[a - 1]
        SET d TO DEQUE INITIALIZED WITH [a - 1]

        SET e TO a - 2
        WHILE e >= 0
            IF d[0] - e >= k THEN
                CALL d.REMOVE_FRONT()
            END IF

            SET b[e] TO energy[e] + b[d[0]]

            IF c < b[e] THEN
                SET c TO b[e]
            END IF

            WHILE (NOT d.EMPTY()) AND b[e] >= b[d.LAST()]
                CALL d.REMOVE_BACK()
            END WHILE

            CALL d.APPEND(e)
            SET e TO e - 1
        END WHILE

        RETURN c
    END FUNCTION
END CLASS