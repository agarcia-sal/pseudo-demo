CLASS Solution  
    FUNCTION numberOfSubarrays(nums)  
        CREATE index_map AS an empty dictionary with default type list  
        
        FOR i FROM 0 TO LENGTH(nums) - 1  
            LET num BE nums[i]  
            ADD i TO index_map[num]  
        END FOR  
        
        INITIALIZE total_count TO 0  
        
        FOR EACH indices IN index_map VALUES  
            LET size BE LENGTH(indices)  
            FOR start_pos FROM 0 TO size - 1  
                FOR end_pos FROM start_pos TO size - 1  
                    LET left_idx BE indices[start_pos]  
                    LET right_idx BE indices[end_pos]  
                    LET segment BE SLICE nums FROM left_idx TO right_idx + 1  
                    LET max_in_segment BE THE MAXIMUM VALUE IN segment  
                    IF max_in_segment IS EQUAL TO nums[left_idx] THEN  
                        INCREMENT total_count BY 1  
                    END IF  
                END FOR  
            END FOR  
        END FOR  
        
        RETURN total_count  
    END FUNCTION  
END CLASS