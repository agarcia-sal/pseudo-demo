CLASS Solution  
    FUNCTION maximumLength(nums, k)  
        LET n BE LENGTH(nums)  
        DECLARE f AS n BY (k + 1) MATRIX FILLED WITH 1  
        LET ans BE 0  
        FOR i FROM 0 TO n - 1  
            LET x BE nums[i]  
            FOR h FROM 0 TO k  
                FOR j FROM 0 TO i - 1  
                    LET y BE nums[j]  
                    IF x == y THEN  
                        f[i][h] = MAX(f[i][h], f[j][h] + 1)  
                    ELSE IF h > 0 THEN  
                        f[i][h] = MAX(f[i][h], f[j][h - 1] + 1)  
                    END IF  
                END FOR  
            END FOR  
            ans = MAX(ans, f[i][k])  
        END FOR  
        RETURN ans  
    END FUNCTION  
END CLASS