CLASS Solution  
    FUNCTION maximumEnergy(energy, k)  
        LET n BE LENGTH OF energy  
        INITIALIZE dp AS ARRAY OF SIZE n WITH ALL ZEROS  
        dp[n - 1] = energy[n - 1]  
        SET max_energy = dp[n - 1]  
        CREATE double_ended_queue WITH ELEMENT n - 1  
        
        FOR index FROM n - 2 DOWN TO 0 STEP -1  
            WHILE double_ended_queue IS NOT EMPTY AND double_ended_queue[0] - index >= k  
                REMOVE FIRST ELEMENT FROM double_ended_queue  
            END WHILE  
            
            dp[index] = energy[index] + dp[double_ended_queue[0]]  
            
            IF dp[index] > max_energy THEN  
                max_energy = dp[index]  
            END IF  
            
            WHILE double_ended_queue IS NOT EMPTY AND dp[index] >= dp[double_ended_queue[-1]]  
                REMOVE LAST ELEMENT FROM double_ended_queue  
            END WHILE  
            
            APPEND index TO double_ended_queue  
        END FOR  
        
        RETURN max_energy  
    END FUNCTION  
END CLASS