CLASS Solution  
    FUNCTION countSubmatrices(grid, k)  
        IF grid IS NULL OR grid[0] IS NULL  
            RETURN 0  
        END IF  

        LET rows BE LENGTH OF grid  
        LET cols BE LENGTH OF grid[0]  
        LET prefix_sum BE A 2D ARRAY OF SIZE rows x cols FILLED WITH 0  
        LET count BE 0  

        FOR row FROM 0 TO rows - 1  
            FOR col FROM 0 TO cols - 1  
                LET top LEFT = IF row > 0 AND col > 0 THEN prefix_sum[row - 1][col - 1] ELSE 0  
                LET top = IF row > 0 THEN prefix_sum[row - 1][col] ELSE 0  
                LET left = IF col > 0 THEN prefix_sum[row][col - 1] ELSE 0  
                prefix_sum[row][col] = grid[row][col] + top + left - top LEFT  

                IF prefix_sum[row][col] <= k  
                    count = count + 1  
                END IF  
            END FOR  
        END FOR  

        RETURN count  
    END FUNCTION  
END CLASS