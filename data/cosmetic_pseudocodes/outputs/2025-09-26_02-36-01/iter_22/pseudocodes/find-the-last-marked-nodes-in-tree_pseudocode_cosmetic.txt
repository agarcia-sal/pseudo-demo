CLASS Solution
    FUNCTION lastMarkedNodes(edges)
        FUNCTION dfs(k, p, r)
            SET m TO LENGTH OF g AT k
            SET q TO 0
            WHILE q LESS THAN m
                SET s TO g AT k AT q
                IF NOT (s EQUALS p)
                    SET r AT s TO r AT k PLUS 1
                    CALL dfs WITH s p r
                END IF
                SET q TO q PLUS 1
            END WHILE
        END FUNCTION

        SET o TO LENGTH OF edges
        SET g TO EMPTY LIST
        SET v TO 0
        REPEAT
            EXIT WHEN v GREATER THAN o
            APPEND EMPTY LIST TO g
            SET v TO v PLUS 1
        UNTIL FALSE

        FOR EACH pair c d IN edges
            SET a TO g AT c
            SET b TO g AT d
            APPEND d TO a
            APPEND c TO b
        END FOR

        SET dist1 TO EMPTY LIST
        SET x TO 0
        REPEAT
            EXIT WHEN x GREATER THAN o
            APPEND -1 TO dist1
            SET x TO x PLUS 1
        UNTIL FALSE
        SET dist1 AT 0 TO 0
        CALL dfs WITH 0 -1 dist1
        SET a TO 0
        SET y TO 1
        WHILE y LESS THAN LENGTH OF dist1
            IF dist1 AT y GREATER THAN dist1 AT a
                SET a TO y
            END IF
            SET y TO y PLUS 1
        END WHILE

        SET dist2 TO EMPTY LIST
        SET z TO 0
        REPEAT
            EXIT WHEN z GREATER THAN o
            APPEND -1 TO dist2
            SET z TO z PLUS 1
        UNTIL FALSE
        SET dist2 AT a TO 0
        CALL dfs WITH a -1 dist2
        SET b TO 0
        SET w TO 1
        WHILE w LESS THAN LENGTH OF dist2
            IF dist2 AT w GREATER THAN dist2 AT b
                SET b TO w
            END IF
            SET w TO w PLUS 1
        END WHILE

        SET dist3 TO EMPTY LIST
        SET r_ TO 0
        REPEAT
            EXIT WHEN r_ GREATER THAN o
            APPEND -1 TO dist3
            SET r_ TO r_ PLUS 1
        UNTIL FALSE
        SET dist3 AT b TO 0
        CALL dfs WITH b -1 dist3

        SET result TO EMPTY LIST
        SET i TO 0
        WHILE i LESS THAN LENGTH OF dist2
            IF dist2 AT i GREATER THAN dist3 AT i
                APPEND a TO result
            ELSE
                APPEND b TO result
            END IF
            SET i TO i PLUS 1
        END WHILE

        RETURN result
    END FUNCTION
END CLASS