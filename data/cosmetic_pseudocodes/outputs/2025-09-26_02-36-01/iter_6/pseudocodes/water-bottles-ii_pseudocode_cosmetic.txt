CLASS Solution
    FUNCTION maxBottlesDrunk(numBottles numBottles numExchange numExchange)
        DEFINE FUNCTION decrementBy(value1 value1, value2 value2)
            RETURN value1 - value2
        END FUNCTION

        DEFINE FUNCTION incrementBy(value1 value1, value2 value2)
            RETURN value1 + value2
        END FUNCTION

        SET total_consumed TO 0 + 0 + 0
        SET empties_collected TO (0 * 1)
        SET current_bottles TO numBottles
        SET exchange_threshold TO numExchange
        SET continue_drinking TO TRUE

        WHILE continue_drinking EQUALS TRUE DO
            IF current_bottles EQUALS 0 THEN
                SET continue_drinking TO FALSE
            ELSE
                SET total_consumed TO incrementBy(total_consumed, current_bottles)
                SET empties_collected TO incrementBy(empties_collected, current_bottles)
                SET current_bottles TO 0

                SET can_exchange TO TRUE
                WHILE can_exchange EQUALS TRUE DO
                    IF NOT (empties_collected >= exchange_threshold) THEN
                        SET can_exchange TO FALSE
                    ELSE
                        SET empties_collected TO decrementBy(empties_collected, exchange_threshold)
                        SET current_bottles TO incrementBy(current_bottles, 1)
                        SET exchange_threshold TO incrementBy(exchange_threshold, 1)
                    END IF
                END WHILE
            END IF
        END WHILE

        RETURN total_consumed
    END FUNCTION
END CLASS