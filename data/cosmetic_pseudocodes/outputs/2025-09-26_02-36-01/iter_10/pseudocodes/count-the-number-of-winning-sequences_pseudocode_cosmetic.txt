CLASS Solution
    FUNCTION countWinningSequences(s)
        CONSTANT MOD = 1000000000 + 7
        MAP M = {F: 0, W: 1, E: 2}

        FUNCTION delta(a, b)
            IF a = b THEN
                RETURN 0
            END IF

            IF a < b THEN
                IF a = 0 AND b = 2 THEN
                    RETURN 1
                ELSE
                    RETURN -1
                END IF
            END IF

            IF a = 2 AND b = 0 THEN
                RETURN -1
            ELSE
                RETURN 1
            END IF
        END FUNCTION

        FUNCTION recur(p, q, r)
            IF (LENGTH(s) - p) <= q THEN
                RETURN 0
            END IF

            IF p >= LENGTH(s) THEN
                IF q < 0 THEN
                    RETURN 1
                ELSE
                    RETURN 0
                END IF
            END IF

            VARIABLE accumulator = 0

            PROCEDURE loopOver(m)
                IF m > 2 THEN RETURN END PROCEDURE
                IF m <> r THEN
                    VARIABLE step = recur(p + 1, q + delta(M[s[p]], m), m)
                    accumulator = (accumulator + step) MOD MOD
                END IF
                loopOver(m + 1)
            END PROCEDURE

            loopOver(0)
            RETURN accumulator
        END FUNCTION

        VARIABLE answer = recur(0, 0, -1)
        CALL dfs cache clear method
        RETURN answer
    END FUNCTION
END CLASS