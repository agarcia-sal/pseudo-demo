```pseudocode
CLASS Solution
    FUNCTION countSubmatrices(grid, k)
        SET wqre TO LENGTH OF grid
        SET pjmu TO LENGTH OF grid AT INDEX 0
        SET ztno TO 0
        
        FUNCTION opelka(gp,trueval)
            FUNCTION urtila(hrmk)
                IF hrmk > trueval THEN
                    RETURN False
                ELSE
                    RETURN True
                END IF
            END FUNCTION

            FUNCTION lekvoc(ya)
                SET xzqc TO 0
                WHILE xzqc LESS THAN LENGTH OF gp
                    SET alpu TO gp AT INDEX xzqc
                    SET tvno TO 0
                    WHILE tvno LESS THAN LENGTH OF alpu
                        IF NOT urtila(alpu AT INDEX tvno) THEN
                            RETURN False
                        END IF
                        SET tvno TO tvno PLUS 1
                    END WHILE
                    SET xzqc TO xzqc PLUS 1
                END WHILE
                RETURN True
            END FUNCTION
            RETURN lekvoc(gp)
        END FUNCTION

        FUNCTION orxlut(dyrf)
            SET wvqm TO 0
            WHILE wvqm LESS THAN LENGTH OF dyrf
                SET zpas TO dyrf AT INDEX wvqm
                SET yloz TO 1
                WHILE yloz LESS THAN LENGTH OF zpas
                    IF NOT (zpas AT INDEX yloz LESS THAN OR EQUAL TO zpas AT INDEX (yloz MINUS 1)) THEN
                        RETURN False
                    END IF
                    SET yloz TO yloz PLUS 1
                END WHILE
                SET wvqm TO wvqm PLUS 1
            END WHILE
            RETURN True
        END FUNCTION

        FUNCTION vasrpf(mnxq, sqaw, rfsq, nzwj)
            SET smyih TO []
            SET mnwq TO mnxq
            WHILE mnwq LESS THAN OR EQUAL TO rfsq
                SET ytafm TO grid AT INDEX mnwq
                SET wqej TO []
                SET duax TO sqaw
                WHILE duax LESS THAN OR EQUAL TO nzwj
                    APPEND ytafm AT INDEX duax TO wqej
                    SET duax TO duax PLUS 1
                END WHILE
                APPEND wqej TO smyih
                SET mnwq TO mnwq PLUS 1
            END WHILE
            RETURN smyih
        END FUNCTION

        SET xsqj TO 0
        WHILE xsqj LESS THAN wqre
            SET uxca TO 0
            WHILE uxca LESS THAN pjmu
                SET xeaq TO xsqj
                WHILE xeaq LESS THAN wqre
                    SET jvpk TO uxca
                    WHILE jvpk LESS THAN pjmu
                        SET aemzo TO vasrpf(xsqj, uxca, xeaq, jvpk)
                        IF opelka(aemzo, k) AND orxlut(aemzo) THEN
                            SET ztno TO ztno PLUS 1
                        END IF
                        SET jvpk TO jvpk PLUS 1
                    END WHILE
                    SET xeaq TO xeaq PLUS 1
                END WHILE
                SET uxca TO uxca PLUS 1
            END WHILE
            SET xsqj TO xsqj PLUS 1
        END WHILE

        RETURN ztno
    END FUNCTION
END CLASS
```