CLASS Solution
    FUNCTION countWinningSequences(s)
        FUNCTION computeDiff(a, b)
            IF a EQUALS b THEN
                RETURN 0
            ELSE
                IF (a LESS THAN b) THEN
                    IF ((a EQUALS 0) AND (b EQUALS 2)) THEN
                        RETURN 1
                    ELSE
                        RETURN -1
                    END IF
                ELSE
                    IF ((a EQUALS 2) AND (b EQUALS 0)) THEN
                        RETURN -1
                    ELSE
                        RETURN 1
                    END IF
                END IF
            END IF
        END FUNCTION

        FUNCTION visit(pos, balance, prev)
            IF ((s.LENGTH MINUS pos) LESS THAN OR EQUAL TO balance) THEN
                RETURN 0
            END IF
            IF pos GREATER THAN OR EQUAL TO s.LENGTH THEN
                IF balance LESS THAN 0 THEN
                    RETURN 1
                ELSE
                    RETURN 0
                END IF
            END IF

            SET total TO 0
            SET index TO 0
            REPEAT
                IF index EQUALS 3 THEN
                    EXIT
                END IF
                IF index NOT EQUAL TO prev THEN
                    SET val TO computeDiff(d[s.GET(pos)], index)
                    SET temp TO visit(pos PLUS 1, balance PLUS val, index)
                    SET total TO (total PLUS temp) MOD mod
                END IF
                SET index TO index PLUS 1
            UNTIL false
            RETURN total
        END FUNCTION

        SET mod TO 1000000000 PLUS 7
        SET d TO MAP WITH KEYS F=0, W=1, E=2
        SET result TO visit(0, 0, -1)
        CALL dfs cache clear method
        RETURN result
    END FUNCTION
END CLASS