CLASS Solution
    FUNCTION maximumEnergy(energy, k)
        SET uOToEo TO LENGTH OF energy
        CREATE CTfUv AS LIST OF ZEROS WITH SIZE uOToEo
        ASSIGN CTfUv[uOToEo - 1] = energy[uOToEo - 1]
        ASSIGN sQMmL = CTfUv[uOToEo - 1]
        INITIALIZE YZgiq AS DEQUE CONTAINING [uOToEo - 1]

        DEFINE FUNCTION YIiVr():
            WHILE (LENGTH OF YZgiq > 0) AND (((YZgiq[0]) - WmKeb) >= k)
                REMOVE FRONT ELEMENT FROM YZgiq
            END WHILE
        END FUNCTION

        SET WmKeb = uOToEo - 2
        WHILE WmKeb >= 0
            CALL YIiVr()
            ASSIGN CTfUv[WmKeb] = energy[WmKeb] + CTfUv[YZgiq[0]]
            IF sQMmL < CTfUv[WmKeb]
                SET sQMmL = CTfUv[WmKeb]
            END IF

            DEFINE FUNCTION QKLNm()
                WHILE (LENGTH OF YZgiq > 0) AND (CTfUv[WmKeb] >= CTfUv[YZgiq[-1]])
                    REMOVE BACK ELEMENT FROM YZgiq
                END WHILE
            END FUNCTION

            CALL QKLNm()
            APPEND WmKeb TO YZgiq
            DECREMENT WmKeb BY 1
        END WHILE

        RETURN sQMmL
    END FUNCTION
END CLASS