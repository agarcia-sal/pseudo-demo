CLASS Solution  
    FUNCTION countSubmatrices(grid, k)  
        SET alpha TO 0  
        SET beta TO LENGTH OF grid  
        SET gamma TO LENGTH OF element at position 0 of grid  
        SET delta TO 0  
        
        FUNCTION verify_limit(matrix)  
            SET omega TO 0  
            WHILE omega < LENGTH OF matrix DO  
                SET psi TO 0  
                REPEAT  
                    IF element at position psi of element at position omega of matrix GREATER THAN k THEN  
                        SET omega TO LENGTH OF matrix  
                        RETURN False  
                    END IF  
                    SET psi TO psi + 1  
                UNTIL psi EQUALS LENGTH OF element at position omega of matrix  
                SET omega TO omega + 1  
            END WHILE  
            RETURN True  
        END FUNCTION  
        
        FUNCTION check_descend(matrix)  
            SET u TO 0  
            WHILE u < LENGTH OF matrix DO  
                SET v TO 1  
                REPEAT  
                    IF element at position v of element at position u of matrix GREATER THAN element at position v - 1 of element at position u of matrix THEN  
                        RETURN False  
                    END IF  
                    SET v TO v + 1  
                UNTIL v EQUALS LENGTH OF element at position u of matrix  
                SET u TO u + 1  
            END WHILE  
            RETURN True  
        END FUNCTION  
        
        SET a1 TO alpha  
        WHILE a1 < beta DO  
            SET b1 TO 0  
            WHILE b1 < gamma DO  
                SET c1 TO a1  
                WHILE c1 < beta DO  
                    SET d1 TO b1  
                    WHILE d1 < gamma DO  
                        SET submatrix TO EMPTY LIST  
                        SET e1 TO a1  
                        WHILE e1 <= c1 DO  
                            SET temp_row TO EMPTY LIST  
                            SET f1 TO b1  
                            WHILE f1 <= d1 DO  
                                APPEND element at position f1 of element at position e1 of grid TO temp_row  
                                SET f1 TO f1 + 1  
                            END WHILE  
                            APPEND temp_row TO submatrix  
                            SET e1 TO e1 + 1  
                        END WHILE  
                        IF verify_limit(submatrix) AND check_descend(submatrix) THEN  
                            SET delta TO delta + 1  
                        END IF  
                        SET d1 TO d1 + 1  
                    END WHILE  
                    SET c1 TO c1 + 1  
                END WHILE  
                SET b1 TO b1 + 1  
            END WHILE  
            SET a1 TO a1 + 1  
        END WHILE  
        
        RETURN delta  
    END FUNCTION  
END CLASS