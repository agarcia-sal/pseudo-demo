CLASS Solution
    FUNCTION countSubmatrices(grid, k)
        SET r TO 0
        SET s TO 0
        SET t TO 0
        SET u TO 0
        SET v TO 0
        SET w TO 0
        SET x TO 0
        SET y TO 0
        SET z TO 0
        FUNCTION computePrefix(a, b, c)
            IF a LESS THAN 0 AND b LESS THAN 0
                RETURN c[a][b]
            ELSE IF a LESS THAN 0
                RETURN c[a][b]
            ELSE IF b LESS THAN 0
                RETURN c[a][b]
            ELSE
                RETURN c[a][b]
            END IF
        END FUNCTION

        FUNCTION isGridInvalid(d)
            RETURN (d EQUALS no value) OR ((d LENGTH EQUALS 0) OR (d[0] EQUALS no value))
        END FUNCTION

        FUNCTION incrementIfAllowed(val, threshold, accumulator)
            IF val LESS THAN OR EQUAL TO threshold
                SET accumulator TO accumulator PLUS 1
            END IF
            RETURN accumulator
        END FUNCTION

        IF (NOT (grid IS no value)) AND (NOT ((grid LENGTH) EQUALS 0)) AND (NOT (grid[0] IS no value))
            SET r TO grid LENGTH
            SET s TO grid[0] LENGTH
        ELSE
            RETURN 0
        END IF

        SET prefix_sum TO new list
        REPEAT
            WHILE y LESS THAN r
                SET prefix_sum[y] TO new list
                SET y TO y PLUS 1
            END WHILE
            UNTIL y EQUALS r

        SET y TO 0
        REPEAT 
            WHILE y LESS THAN r
                SET z TO 0
                REPEAT
                    WHILE z LESS THAN s
                        SET prefix_sum[y][z] TO 0
                        SET z TO z PLUS 1
                    END WHILE
                    UNTIL z EQUALS s
                SET y TO y PLUS 1
            END WHILE
            UNTIL y EQUALS r

        SET w TO 0
        REPEAT
            IF w GREATER THAN OR EQUAL TO r
                BREAK
            END IF
            SET v TO 0
            REPEAT
                IF v GREATER THAN OR EQUAL TO s
                    BREAK
                END IF
                SET a TO 0
                SET b TO 0
                SET c TO 0
                IF w EQUALS 0 AND v EQUALS 0
                    SET prefix_sum[w][v] TO grid[w][v]
                ELSE
                    IF w EQUALS 0
                        SET a TO prefix_sum[w][v - 1]
                        SET b TO grid[w][v]
                        SET prefix_sum[w][v] TO a PLUS b
                    ELSE
                        IF v EQUALS 0
                            SET a TO prefix_sum[w - 1][v]
                            SET b TO grid[w][v]
                            SET prefix_sum[w][v] TO a PLUS b
                        ELSE
                            SET a TO prefix_sum[w][v - 1]
                            SET b TO prefix_sum[w - 1][v]
                            SET c TO prefix_sum[w - 1][v - 1]
                            SET t TO grid[w][v]
                            SET prefix_sum[w][v] TO a PLUS b MINUS c PLUS t
                        END IF
                    END IF
                END IF
                SET count TO incrementIfAllowed(prefix_sum[w][v], k, count)
                SET v TO v PLUS 1
            UNTIL FALSE
            SET w TO w PLUS 1
        UNTIL FALSE

        IF count IS no value
            RETURN 0
        ELSE
            RETURN count
        END IF
    END FUNCTION
END CLASS