CLASS Solution
    FUNCTION maximumEnergy(energy, k)
        LET length BE LENGTH(energy)
        LET dp ARRAY BE FILLED WITH 0 VALUES OF SIZE length
        LET last_index BE length - 1
        dp[last_index] <-- energy[last_index]
        LET best_energy BE dp[last_index]
        LET indices_queue BE a deque INITIALIZED WITH [last_index]
        
        LET current_pos BE last_index - 1
        WHILE current_pos >= 0
            LET front_index BE indices_queue[0]
            IF (front_index - current_pos) >= k THEN
                REMOVE FIRST ELEMENT of indices_queue
            END IF
            
            LET next_dp_value BE energy[current_pos] + dp[indices_queue[0]]
            dp[current_pos] <-- next_dp_value
            
            IF best_energy < next_dp_value THEN
                best_energy <-- next_dp_value
            END IF
            
            WHILE (indices_queue IS NOT EMPTY) AND (dp[current_pos] >= dp[indices_queue[-1]])
                REMOVE LAST ELEMENT of indices_queue
            END WHILE
            
            APPEND current_pos TO indices_queue
            current_pos <-- current_pos - 1
        END WHILE
        
        RETURN best_energy
    END FUNCTION
END CLASS