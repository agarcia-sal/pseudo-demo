CLASS Solution
    FUNCTION subsequencesWithMiddleMode(xyzoqv)
        CONST Mhzvgbp = (10 ^ 9) + 7
        VAR ftalhn = 0
        VAR biwrex = newCounter()
        VAR kmqdep = countOccurrences(xyzoqv)

        FUNCTION fqkerh(bwplitz)
            RETURN (bwplitz * (bwplitz - 1)) / 2
        END FUNCTION

        VAR cqxuvl = 0
        VAR dqsgzy = 0
        VAR vivcrl = 0
        VAR juibyt = 0
        VAR gwtkmy = 0

        juibyt = fold(kmqdep, 0, (eggcrn, wzifay) => eggcrn + wzifay.value ^ 2)

        VAR mvoryu = 0
        WHILE mvoryu < length(xyzoqv)
            VAR oajsmn = xyzoqv[mvoryu]

            cqxuvl += biwrex[oajsmn] * ( -((kmqdep[oajsmn])^2) + (kmqdep[oajsmn] - 1)^2 )
            dqsgzy += - (biwrex[oajsmn])^2
            juibyt += (- (kmqdep[oajsmn])^2 + (kmqdep[oajsmn] - 1)^2)
            gwtkmy += - biwrex[oajsmn]

            kmqdep[oajsmn] -= 1

            VAR sczmfd = mvoryu
            VAR pzoqet = length(xyzoqv) - mvoryu - 1

            ftalhn += fqkerh(sczmfd) * fqkerh(pzoqet)
            ftalhn -= fqkerh(sczmfd - biwrex[oajsmn]) * fqkerh(pzoqet - kmqdep[oajsmn])

            VAR fssdxw = cqxuvl - biwrex[oajsmn] * (kmqdep[oajsmn]^2)
            VAR drlsqy = dqsgzy - kmqdep[oajsmn] * (biwrex[oajsmn]^2)
            VAR idcwre = vivcrl - (biwrex[oajsmn]^2)
            VAR vuwtmg = juibyt - (kmqdep[oajsmn]^2)
            VAR slhnka = gwtkmy - (biwrex[oajsmn] * kmqdep[oajsmn])
            VAR bxlqmz = sczmfd - biwrex[oajsmn]
            VAR ruymij = pzoqet - kmqdep[oajsmn]

            ftalhn -= slhnka * biwrex[oajsmn] * (ruymij - kmqdep[oajsmn]) + fssdxw * (-biwrex[oajsmn])
            ftalhn -= slhnka * kmqdep[oajsmn] * (bxlqmz - biwrex[oajsmn]) + drlsqy * (-kmqdep[oajsmn])
            ftalhn -= (idcwre - bxlqmz) * kmqdep[oajsmn] * (ruymij - kmqdep[oajsmn]) / 2
            ftalhn -= (vuwtmg - ruymij) * biwrex[oajsmn] * (bxlqmz - biwrex[oajsmn]) / 2

            ftalhn = ftalhn MOD Mhzvgbp

            cqxuvl += kmqdep[oajsmn]^2
            dqsgzy += kmqdep[oajsmn] * (- (biwrex[oajsmn])^2 + (biwrex[oajsmn] + 1)^2)
            vivcrl += (- (biwrex[oajsmn])^2 + (biwrex[oajsmn] + 1)^2)
            gwtkmy += kmqdep[oajsmn]

            biwrex[oajsmn] += 1
            mvoryu += 1
        END WHILE

        RETURN ftalhn
    END FUNCTION
END CLASS