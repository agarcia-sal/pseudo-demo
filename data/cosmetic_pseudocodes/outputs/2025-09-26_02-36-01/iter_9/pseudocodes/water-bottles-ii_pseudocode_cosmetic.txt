CLASS Solution
    FUNCTION maxBottlesDrunk(numBottles numBottles numExchange numExchange)
        FUNCTION calcNewBottles(consumed INTEGER, empties INTEGER, exchangeRate INTEGER) RETURNS INTEGER
            SET gained TO 0
            SET rest TO empties
            REPEAT
                IF rest < exchangeRate THEN
                    BREAK
                END IF
                SET rest TO rest - exchangeRate
                SET gained TO gained + 1
                SET rest TO rest + 1
            UNTIL FALSE
            RETURN gained
        END FUNCTION

        SET aggregateDrank TO 0
        SET residualEmpties TO 0

        LABEL startDrinkingLoop
        IF NOT (numBottles > 0) THEN GOTO endDrinkingLoop

        SET aggregateDrank TO aggregateDrank + numBottles
        SET residualEmpties TO residualEmpties + numBottles
        SET numBottles TO 0

        LABEL startExchangeLoop
        IF NOT (residualEmpties >= numExchange) THEN GOTO afterExchangeLoop

        SET residualEmpties TO residualEmpties - numExchange
        SET numBottles TO numBottles + 1
        SET numExchange TO numExchange + 1
        GOTO startExchangeLoop

        LABEL afterExchangeLoop
        GOTO startDrinkingLoop
        LABEL endDrinkingLoop

        RETURN aggregateDrank
    END FUNCTION
END CLASS