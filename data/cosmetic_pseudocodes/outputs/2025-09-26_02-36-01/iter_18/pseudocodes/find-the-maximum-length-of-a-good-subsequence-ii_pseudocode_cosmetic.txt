```pseudocode
CLASS Solution
    FUNCTION maximumLength(nums PARAMETER, k PARAMETER)
        SET alpha TO LENGTH OF nums
        SET delta TO a 2D list filled with zeros sized alpha BY (k + 1)
        SET omega TO a list of default dictionaries with default value zero sized (k + 1)
        SET sigma TO a 2D list filled with zeros sized (k + 1) BY 3
        SET rho TO 0
        SET m TO 0
        WHILE m < alpha
            SET z TO nums AT m
            SET c TO 0
            LOOP
                IF c > k THEN
                    BREAK
                END IF

                SET delta[m][c] TO omega[c][z]
                IF c <> 0 THEN
                    IF sigma[c - 1][0] <> nums[m] THEN
                        SET delta[m][c] TO MAX(delta[m][c], sigma[c - 1][1])
                    ELSE
                        SET delta[m][c] TO MAX(delta[m][c], sigma[c - 1][2])
                    END IF
                END IF

                SET delta[m][c] TO delta[m][c] + 1
                SET omega[c][nums[m]] TO MAX(omega[c][nums[m]], delta[m][c])

                IF sigma[c][0] <> z THEN
                    IF delta[m][c] >= sigma[c][1] THEN
                        SET sigma[c][2] TO sigma[c][1]
                        SET sigma[c][1] TO delta[m][c]
                        SET sigma[c][0] TO z
                    ELSE
                        SET sigma[c][2] TO MAX(sigma[c][2], delta[m][c])
                    END IF
                ELSE
                    SET sigma[c][1] TO MAX(sigma[c][1], delta[m][c])
                END IF

                SET rho TO MAX(rho, delta[m][c])

                SET c TO c + 1
            END LOOP

            SET m TO m + 1
        END WHILE
        RETURN rho
    END FUNCTION
END CLASS
```