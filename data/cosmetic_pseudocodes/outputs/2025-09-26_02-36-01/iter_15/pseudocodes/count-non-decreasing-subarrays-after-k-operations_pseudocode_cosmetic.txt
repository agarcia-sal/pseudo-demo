``` 
CLASS Solution
    FUNCTION countNonDecreasingSubarrays(nums k)
        SET m TO LENGTH OF nums

        FUNCTION canMakeNonDecreasing(x y)
            SET p TO 0
            SET q TO nums[x]
            SET r TO 1
            WHILE r < y DO
                SET s TO nums[x + r]
                IF s < q THEN
                    SET p TO p + (q - s)
                END IF
                IF q < s THEN
                    SET q TO s
                END IF
                IF p > k THEN
                    RETURN False
                END IF
                SET r TO r + 1
            END WHILE
            RETURN True
        END FUNCTION

        SET a TO (m * (m + 1)) / 2
        SET b TO 0

        SET c TO 0
        WHILE c < m DO
            SET d TO 1
            SET e TO m - c
            WHILE d <= e DO
                SET f TO (d + e) // 2
                IF canMakeNonDecreasing(c f) THEN
                    SET d TO f + 1
                ELSE
                    SET e TO f - 1
                END IF
            END WHILE
            SET b TO b + (m - c - e)
            SET c TO c + 1
        END WHILE

        RETURN a - b
    END FUNCTION
END CLASS
```