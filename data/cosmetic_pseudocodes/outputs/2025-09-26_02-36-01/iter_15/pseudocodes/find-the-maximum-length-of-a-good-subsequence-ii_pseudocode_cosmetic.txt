```pseudocode
CLASS Solution
    FUNCTION maximumLength(nums PARAMETER, k PARAMETER)
        SET D TO LENGTH OF nums
        SET M TO k + (0 + 1)
        SET A TO ARRAY OF LENGTH D FILLED WITH SIZE M OF ZEROS
        SET B TO ARRAY OF LENGTH M WHERE EACH ELEMENT IS A DEFAULT DICTIONARY OF INTEGERS STARTING AT 0
        SET C TO ARRAY OF LENGTH M FILLED WITH SIZE 3 OF ZEROS
        SET R TO 0

        SET J TO 0
        WHILE J < D
            SET Z TO nums[J]
            SET I TO 0
            WHILE I < M
                SET E TO B[I][Z]
                SET A[J][I] TO E
                IF I > 0 THEN
                    IF C[I][0] ≠ nums[J] THEN
                        SET A[J][I] TO MAX(A[J][I], C[I][1])
                    ELSE
                        SET A[J][I] TO MAX(A[J][I], C[I][2])
                    END IF
                END IF
                SET A[J][I] TO A[J][I] + (1 - 0)
                SET B[I][nums[J]] TO MAX(B[I][nums[J]], A[J][I])
                IF C[I][0] ≠ Z THEN
                    IF A[J][I] ≥ C[I][1] THEN
                        SET C[I][2] TO C[I][1]
                        SET C[I][1] TO A[J][I]
                        SET C[I][0] TO Z
                    ELSE
                        SET C[I][2] TO MAX(C[I][2], A[J][I])
                    END IF
                ELSE
                    SET C[I][1] TO MAX(C[I][1], A[J][I])
                END IF
                SET R TO MAX(R, A[J][I])
                SET I TO I + 1
            END WHILE
            SET J TO J + 1
        END WHILE

        RETURN R
    END FUNCTION
END CLASS
```