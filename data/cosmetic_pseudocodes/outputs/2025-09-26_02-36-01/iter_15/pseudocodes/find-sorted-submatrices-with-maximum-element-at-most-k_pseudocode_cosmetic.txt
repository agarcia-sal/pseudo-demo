``` 
CLASS Solution
    FUNCTION countSubmatrices(grid, k)
        SET alpha TO LENGTH(grid)
        SET beta TO LENGTH(grid[0])
        SET omega TO 0

        FUNCTION is_valid_submatrix(submatrix)
            SET idx_outer TO 0
            WHILE idx_outer < LENGTH(submatrix)
                SET idx_inner TO 0
                WHILE idx_inner < LENGTH(submatrix[idx_outer])
                    IF submatrix[idx_outer][idx_inner] > k THEN
                        RETURN False
                    END IF
                    SET idx_inner TO idx_inner + 1
                END WHILE
                SET idx_outer TO idx_outer + 1
            END WHILE
            RETURN True
        END FUNCTION

        FUNCTION is_sorted_submatrix(submatrix)
            SET p TO 0
            WHILE p < LENGTH(submatrix)
                SET q TO 1
                WHILE q < LENGTH(submatrix[p])
                    IF submatrix[p][q] > submatrix[p][q-1] THEN
                        RETURN False
                    END IF
                    SET q TO q + 1
                END WHILE
                SET p TO p + 1
            END WHILE
            RETURN True
        END FUNCTION

        SET a1 TO 0
        WHILE a1 <= alpha - 1
            SET b1 TO 0
            WHILE b1 <= beta - 1
                SET a2 TO a1
                WHILE a2 <= alpha - 1
                    SET b2 TO b1
                    WHILE b2 <= beta - 1
                        SET submatrix_temp TO []
                        SET c1 TO a1
                        WHILE c1 <= a2
                            SET row_slice TO []
                            SET c2 TO b1
                            WHILE c2 <= b2
                                CALL row_slice.APPEND(grid[c1][c2])
                                SET c2 TO c2 + 1
                            END WHILE
                            CALL submatrix_temp.APPEND(row_slice)
                            SET c1 TO c1 + 1
                        END WHILE
                        IF is_valid_submatrix(submatrix_temp) AND is_sorted_submatrix(submatrix_temp) THEN
                            SET omega TO omega + 1
                        END IF
                        SET b2 TO b2 + 1
                    END WHILE
                    SET a2 TO a2 + 1
                END WHILE
                SET b1 TO b1 + 1
            END WHILE
            SET a1 TO a1 + 1
        END WHILE

        RETURN omega
    END FUNCTION
END CLASS
```