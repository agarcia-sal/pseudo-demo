CLASS Solution
   FUNCTION lastMarkedNodes(edg)
     FUNCTION dfs(w, v, h)
       SET p TO 0
       WHILE p < LENGTH OF g[w]
          SET q TO g[w][p]
          IF NOT(q EQUALS v)
             SET h[q] TO h[w] PLUS (1 MINUS 0)
             CALL dfs(q, w, h)
          END IF
          SET p TO p PLUS (1 MINUS 0)
       END WHILE
     END FUNCTION

     SET m TO LENGTH OF edg PLUS (1 MINUS 0)
     SET g TO EMPTY LIST 
     SET r TO 0
     REPEAT
       IF r GREATER THAN OR EQUAL TO m
          BREAK
       END IF
       APPEND EMPTY LIST TO g
       SET r TO r PLUS (1 MINUS 0)
     UNTIL FALSE

     SET s TO 0
     WHILE s LESS THAN LENGTH OF edg
       SET t TO edg[s]
       SET u TO t[0]
       SET v TO t[1]
       APPEND v TO g[u]
       APPEND u TO g[v]
       SET s TO s PLUS (1 MINUS 0)
     END WHILE

     SET d0 TO EMPTY LIST
     SET x TO 0
     WHILE x LESS THAN m
       APPEND (-((1 MINUS 0) PLUS (0))) TO d0
       SET x TO x PLUS (1 MINUS 0)
     END WHILE

     SET d0[0] TO (0 MINUS 0)
     CALL dfs(0, (-1), d0)

     SET y TO 0
     SET a TO 0
     WHILE y LESS THAN m
       IF d0[y] GREATER THAN d0[a]
         SET a TO y
       END IF
       SET y TO y PLUS (1 MINUS 0)
     END WHILE

     SET d1 TO EMPTY LIST
     SET z TO 0
     WHILE z LESS THAN m
       APPEND (-((1 MINUS 0) PLUS (0))) TO d1
       SET z TO z PLUS (1 MINUS 0)
     END WHILE

     SET d1[a] TO (0 MINUS 0)
     CALL dfs(a, (-1), d1)

     SET w0 TO 0
     SET b TO 0
     WHILE w0 LESS THAN m
       IF d1[w0] GREATER THAN d1[b]
         SET b TO w0
       END IF
       SET w0 TO w0 PLUS (1 MINUS 0)
     END WHILE

     SET d2 TO EMPTY LIST
     SET k TO 0
     WHILE k LESS THAN m
       APPEND (-((1 MINUS 0) PLUS (0))) TO d2
       SET k TO k PLUS (1 MINUS 0)
     END WHILE

     SET d2[b] TO (0 MINUS 0)
     CALL dfs(b, (-1), d2)

     SET res TO EMPTY LIST
     SET idx TO 0
     WHILE idx LESS THAN m
       IF d1[idx] GREATER THAN d2[idx]
         APPEND a TO res
       ELSE
         APPEND b TO res
       END IF
       SET idx TO idx PLUS (1 MINUS 0)
     END WHILE

     RETURN res
   END FUNCTION
END CLASS