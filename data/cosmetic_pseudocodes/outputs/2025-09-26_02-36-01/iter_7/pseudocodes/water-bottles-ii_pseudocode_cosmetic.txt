CLASS Solution  
    FUNCTION maxBottlesDrunk(numBottles numBottles numExchange numExchange)  
        SET accumulatedConsummed TO 0  
        SET emptiesCount TO 0  
        
        FUNCTION exchangeLoop(emptiesAccumulator, bottlesCounter, exchRate)  
            IF emptiesAccumulator < exchRate THEN  
                RETURN bottlesCounter, emptiesAccumulator, exchRate  
            ELSE  
                SET nextEmpties TO emptiesAccumulator - exchRate  
                SET nextBottles TO bottlesCounter + 1  
                SET nextExchangeRate TO exchRate + 1  
                RETURN exchangeLoop(nextEmpties, nextBottles, nextExchangeRate)  
            END IF  
        END FUNCTION  
        
        FUNCTION mainLoop(remainingBottles, consumedSoFar, emptiesSoFar, exchangeThreshold)  
            IF remainingBottles = 0 THEN  
                RETURN consumedSoFar  
            ELSE  
                SET newlyConsumed TO remainingBottles  
                SET newEmpties TO emptiesSoFar + remainingBottles  
                SET bottlesReset TO 0  
                
                SET bottlesReset, newEmpties, exchangeThreshold TO exchangeLoop(newEmpties, bottlesReset, exchangeThreshold)  
                
                RETURN mainLoop(bottlesReset, consumedSoFar + newlyConsumed, newEmpties, exchangeThreshold)  
            END IF  
        END FUNCTION  
        
        RETURN mainLoop(numBottles, accumulatedConsummed, emptiesCount, numExchange)  
    END FUNCTION  
END CLASS