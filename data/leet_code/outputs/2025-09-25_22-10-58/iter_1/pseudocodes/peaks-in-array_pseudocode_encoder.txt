CLASS Solution  
    FUNCTION countOfPeaks(nums LIST OF INTEGER, queries LIST OF LIST OF INTEGER) RETURNS LIST OF INTEGER  
        FUNCTION is_peak(i INTEGER) RETURNS BOOLEAN  
            RETURN element at position i MINUS one of nums LESS THAN element at position i of nums AND element at position i of nums GREATER THAN element at position i PLUS one of nums  
        END FUNCTION  
        
        SET peaks TO empty list  
        FOR i FROM one TO LENGTH OF nums MINUS two  
            IF is_peak(i) EQUALS true  
                APPEND i TO peaks  
            END IF  
        END FOR  
        
        SET result TO empty list  
        FOR each query IN queries  
            IF element at position zero of query EQUALS one  
                SET li TO element at position one of query  
                SET ri TO element at position two of query  
                SET left_index TO the LEFT insertion position of li PLUS one in peaks  
                SET right_index TO the RIGHT insertion position of ri MINUS one in peaks  
                APPEND right_index MINUS left_index TO result  
            ELSE  
                SET indexi TO element at position one of query  
                SET vali TO element at position two of query  
                IF element at position indexi of nums EQUALS vali  
                    CONTINUE TO next query  
                END IF  
                SET element at position indexi of nums TO vali  
                FOR i FROM the GREATER OF one AND indexi MINUS one TO the SMALLER OF LENGTH OF nums MINUS two AND indexi PLUS one  
                    IF is_peak(i) EQUALS true  
                        IF i NOT IN peaks  
                            INSERT i INTO peaks AT sorted position  
                        END IF  
                    ELSE  
                        IF i IN peaks  
                            REMOVE i FROM peaks  
                        END IF  
                    END IF  
                END FOR  
            END IF  
        END FOR  
        
        RETURN result  
    END FUNCTION  
END CLASS