CLASS Solution  
    FUNCTION numberOfSubarrays(nums)  
        ASSIGN reference TO default dictionary mapping to list named index_map  
        FOR each index i AND each element num IN the enumeration of nums  
            APPEND index i TO the list at key num in index_map  
        END FOR  
        
        SET count TO zero  
        FOR each list of indices IN the values of index_map  
            SET m TO the length of indices  
            FOR index i FROM zero TO m MINUS one  
                FOR index j FROM i TO m MINUS one  
                    DEFINE subarray AS the elements starting from element at position indices AT index i OF nums TO element at position indices AT index j OF nums inclusive  
                    IF the maximum value in subarray EQUALS element at position indices AT index i OF nums  
                        INCREMENT count BY one  
                    END IF  
                END FOR  
            END FOR  
        END FOR  
        
        RETURN count  
    END FUNCTION  
END CLASS