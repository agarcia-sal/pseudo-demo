CLASS Solution  
    FUNCTION countSubmatrices(grid, k)  
        SET m TO the LENGTH OF grid  
        SET n TO the LENGTH OF element at position zero of grid  
        SET count TO zero  
        
        FUNCTION is_valid_submatrix(submatrix)  
            FOR each row IN submatrix  
                FOR each val IN row  
                    IF val GREATER THAN k THEN  
                        RETURN False  
                    END IF  
                END FOR  
            END FOR  
            RETURN True  
        END FUNCTION  
        
        FUNCTION is_sorted_submatrix(submatrix)  
            FOR each row IN submatrix  
                FOR j FROM one TO the LENGTH OF row MINUS one  
                    IF element at position j of row GREATER THAN element at position j MINUS one of row THEN  
                        RETURN False  
                    END IF  
                END FOR  
            END FOR  
            RETURN True  
        END FUNCTION  
        
        FOR x1 FROM zero TO m MINUS one  
            FOR y1 FROM zero TO n MINUS one  
                FOR x2 FROM x1 TO m MINUS one  
                    FOR y2 FROM y1 TO n MINUS one  
                        SET submatrix TO the list of elements obtained by FOR each row IN the sublist of grid from position x1 TO position x2 inclusive SELECTING the sublist of row from position y1 TO position y2 inclusive  
                        IF is_valid_submatrix(submatrix) AND is_sorted_submatrix(submatrix) THEN  
                            INCREMENT count BY one  
                        END IF  
                    END FOR  
                END FOR  
            END FOR  
        END FOR  
        
        RETURN count  
    END FUNCTION  
END CLASS