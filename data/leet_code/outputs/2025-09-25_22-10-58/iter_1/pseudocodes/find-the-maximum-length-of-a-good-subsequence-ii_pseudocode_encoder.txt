CLASS Solution  
    FUNCTION maximumLength(nums PARAMETER, k PARAMETER)  
        SET n TO the LENGTH OF nums  
        SET f TO a two-dimensional list of zeros with dimensions n BY k PLUS one  
        SET mp TO a list of default dictionaries mapping to zero with length k PLUS one  
        SET g TO a two-dimensional list of zeros with dimensions k PLUS one BY three  
        SET ans TO zero  
        FOR each index i AND element x IN nums WITH their positions  
            FOR each number h FROM zero TO k  
                SET element at position i of f at position h TO the value at key x in the default dictionary at position h of mp  
                IF h IS GREATER THAN zero THEN  
                    IF the first element of g at position h MINUS one IS NOT EQUALS element at position i of nums THEN  
                        SET element at position i of f at position h TO THE GREATER VALUE BETWEEN its current value AND the second element of g at position h MINUS one  
                    ELSE  
                        SET element at position i of f at position h TO THE GREATER VALUE BETWEEN its current value AND the third element of g at position h MINUS one  
                    END IF  
                END IF  
                INCREMENT element at position i of f at position h BY one  
                SET the value at key element at position i of nums in the default dictionary at position h of mp TO THE GREATER VALUE BETWEEN its current value AND element at position i of f at position h  
                IF the first element of g at position h IS NOT EQUALS x THEN  
                    IF element at position i of f at position h IS GREATER THAN OR EQUAL TO the second element of g at position h THEN  
                        SET the third element of g at position h TO the second element of g at position h  
                        SET the second element of g at position h TO element at position i of f at position h  
                        SET the first element of g at position h TO x  
                    ELSE  
                        SET the third element of g at position h TO THE GREATER VALUE BETWEEN its current value AND element at position i of f at position h  
                    END IF  
                ELSE  
                    SET the second element of g at position h TO THE GREATER VALUE BETWEEN its current value AND element at position i of f at position h  
                END IF  
                SET ans TO THE GREATER VALUE BETWEEN ans AND element at position i of f at position h  
            END FOR  
        END FOR  
        RETURN ans  
    END FUNCTION  
END CLASS