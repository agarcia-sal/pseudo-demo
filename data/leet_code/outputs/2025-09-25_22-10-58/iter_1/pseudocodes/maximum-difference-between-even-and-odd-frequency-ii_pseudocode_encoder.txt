CLASS Solution  
    FUNCTION maxDifference WITH PARAMETERS s k  
        SET ans TO negative infinity  
        SET permutations TO list of pairs a b SUCH THAT a IS element FROM string consisting of zero one two three four AND b IS element FROM string consisting of zero one two three four AND a IS NOT EQUALS b  
        FOR each pair a b IN permutations  
            SET minDiff TO default dictionary WITH default value infinity  
            SET prefixA TO list CONTAINING zero  
            SET prefixB TO list CONTAINING zero  
            SET l TO zero  
            FOR each pair r c OBTAINED BY enumerating characters of s  
                APPEND TO prefixA the element at position last of prefixA PLUS one IF c EQUALS a OTHERWISE zero  
                APPEND TO prefixB the element at position last of prefixB PLUS one IF c EQUALS b OTHERWISE zero  
                WHILE length of substring from l TO r OF s IS GREATER THAN OR EQUAL TO k  
                      AND element at position l of prefixA IS LESS THAN element at position last of prefixA  
                      AND element at position l of prefixB IS LESS THAN element at position last of prefixB  
                    SET paritiesKey TO tuple OF remainder of element at position l of prefixA DIVIDED BY two AND remainder of element at position l of prefixB DIVIDED BY two  
                    SET minDiff at paritiesKey TO the smaller value BETWEEN minDiff at paritiesKey AND element at position l of prefixA MINUS element at position l of prefixB  
                    INCREMENT l BY one  
                END WHILE  
                SET ans TO the larger value BETWEEN ans AND element at position last of prefixA MINUS element at position last of prefixB MINUS minDiff AT tuple OF remainder of one MINUS remainder of element at position last of prefixA DIVIDED BY two AND remainder of element at position last of prefixB DIVIDED BY two  
            END FOR  
        END FOR  
        RETURN ans  
    END FUNCTION  
END CLASS