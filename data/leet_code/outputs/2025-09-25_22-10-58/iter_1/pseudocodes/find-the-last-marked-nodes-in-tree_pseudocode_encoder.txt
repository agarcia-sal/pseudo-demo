CLASS Solution  
    FUNCTION lastMarkedNodes(edges)  
        FUNCTION dfs(i, fa, dist)  
            FOR each element j IN element at position i of g  
                IF j NOT EQUALS fa  
                    SET element at position j of dist TO element at position i of dist PLUS one  
                    CALL dfs WITH j fa dist  
                END IF  
            END FOR  
        END FUNCTION  

        SET n TO the LENGTH OF edges PLUS one  
        SET g TO a new list containing n empty lists  
        FOR each pair u v IN edges  
            APPEND v TO element at position u of g  
            APPEND u TO element at position v of g  
        END FOR  

        SET dist1 TO a new list containing n elements each EQUAL TO negative one  
        SET element at position zero of dist1 TO zero  
        CALL dfs WITH zero MINUS one dist1  
        SET a TO the POSITION OF the MAXIMUM VALUE IN dist1  

        SET dist2 TO a new list containing n elements each EQUAL TO negative one  
        SET element at position a of dist2 TO zero  
        CALL dfs WITH a MINUS one dist2  
        SET b TO the POSITION OF the MAXIMUM VALUE IN dist2  

        SET dist3 TO a new list containing n elements each EQUAL TO negative one  
        SET element at position b of dist3 TO zero  
        CALL dfs WITH b MINUS one dist3  

        SET result TO a new empty list  
        FOR each pair x y IN the PAIRWISE ELEMENTS OF dist2 AND dist3  
            IF x GREATER THAN y  
                APPEND a TO result  
            ELSE  
                APPEND b TO result  
            END IF  
        END FOR  

        RETURN result  
    END FUNCTION  
END CLASS